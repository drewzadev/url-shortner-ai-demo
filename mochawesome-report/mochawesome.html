<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:51,&quot;tests&quot;:204,&quot;passes&quot;:93,&quot;pending&quot;:0,&quot;failures&quot;:111,&quot;start&quot;:&quot;2025-06-05T14:54:17.373Z&quot;,&quot;end&quot;:&quot;2025-06-05T14:54:17.602Z&quot;,&quot;duration&quot;:229,&quot;testsRegistered&quot;:204,&quot;passPercent&quot;:45.588235294117645,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;fe70acc0-55dd-4fd5-a5ae-faab4a25444b&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4031472f-b95a-4c96-8ee2-fd51b7f08911&quot;,&quot;title&quot;:&quot;API Bulk Operations Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-bulk-operations.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests \&quot;before all\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox()\n\n// Create Express app\napp = express()\napp.use(express.json({ limit: &#x27;10mb&#x27; })) // Increase limit for bulk testing\n// Mock services\nmockDatabaseService = {\n  getClient: sandbox.stub().returns({\n    url: {\n      create: sandbox.stub(),\n      findUnique: sandbox.stub(),\n      findMany: sandbox.stub(),\n      delete: sandbox.stub(),\n      update: sandbox.stub()\n    },\n    $transaction: sandbox.stub()\n  }),\n  healthCheck: sandbox.stub().resolves(true)\n}\nmockRedisService = {\n  getShortCode: sandbox.stub(),\n  cacheUrl: sandbox.stub(),\n  getCachedUrl: sandbox.stub(),\n  removeCachedUrl: sandbox.stub(),\n  isHealthy: sandbox.stub().returns(true)\n}\nmockLogger = {\n  debug: sandbox.stub(),\n  info: sandbox.stub(),\n  warn: sandbox.stub(),\n  error: sandbox.stub(),\n  fatal: sandbox.stub()\n}\n// Use test routes with mocked dependencies\napp.use(&#x27;/api&#x27;, createApiRoutes(mockDatabaseService, mockRedisService, mockLogger))&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78c81646-13b3-44e9-8409-bf9de4b7fa5d&quot;,&quot;parentUUID&quot;:&quot;4031472f-b95a-4c96-8ee2-fd51b7f08911&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests \&quot;before each\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.resetHistory()\n// Set up default mocks for short code generation\nmockRedisService.getShortCode.callsFake(() =&gt; {\n  const codes = [&#x27;abc123&#x27;, &#x27;def456&#x27;, &#x27;ghi789&#x27;, &#x27;jkl012&#x27;, &#x27;mno345&#x27;]\n  return Promise.resolve(codes[Math.floor(Math.random() * codes.length)])\n})\nmockRedisService.cacheUrl.resolves()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;70511d05-ab7e-4f1b-9b7a-16980071525e&quot;,&quot;parentUUID&quot;:&quot;4031472f-b95a-4c96-8ee2-fd51b7f08911&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests \&quot;after all\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75240814-0790-4aca-a8d0-d9d3aae490c5&quot;,&quot;parentUUID&quot;:&quot;4031472f-b95a-4c96-8ee2-fd51b7f08911&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests \&quot;after each\&quot; hook in \&quot;API Bulk Operations Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.resetHistory()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;86274966-3693-49d3-a774-93605529f751&quot;,&quot;parentUUID&quot;:&quot;4031472f-b95a-4c96-8ee2-fd51b7f08911&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;title&quot;:&quot;POST /api/shorten/bulk - Payload Size Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-bulk-operations.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle minimum payload (1 URL)&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests POST /api/shorten/bulk - Payload Size Tests should handle minimum payload (1 URL)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [&#x27;https://example.com/single&#x27;]\n\nconst mockDbResults = [{\n  id: &#x27;test-id-1&#x27;,\n  originalUrl: urls[0],\n  shortCode: &#x27;abc123&#x27;,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}]\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(1)\nexpect(response.body.data[0].original_url).to.equal(urls[0])&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:97:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;27cc5ee1-5e09-4f12-8025-eeea70b529aa&quot;,&quot;parentUUID&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle small batch (10 URLs)&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests POST /api/shorten/bulk - Payload Size Tests should handle small batch (10 URLs)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(10).fill().map((_, i) =&gt; `https://example.com/url-${i}`)\n\nconst mockDbResults = urls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `code-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(10)\n\n// Verify all URLs are processed\nresponse.body.data.forEach((item, index) =&gt; {\n  expect(item.original_url).to.equal(urls[index])\n  expect(item.short_code).to.be.a(&#x27;string&#x27;)\n  expect(item.short_url).to.include(item.short_code)\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:121:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;0ec53296-0bc2-44bf-a4c8-1c2d815c3901&quot;,&quot;parentUUID&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle medium batch (100 URLs)&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests POST /api/shorten/bulk - Payload Size Tests should handle medium batch (100 URLs)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(100).fill().map((_, i) =&gt; `https://example.com/medium-${i}`)\n\nconst mockDbResults = urls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `med-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst startTime = Date.now()\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nconst endTime = Date.now()\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(100)\nexpect(endTime - startTime).to.be.lessThan(5000) // Should complete within 5 seconds\n// Verify transaction was called once for all URLs\nexpect(mockDatabaseService.getClient().$transaction).to.have.been.calledOnce&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:152:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;ea11d0f6-9480-458d-af88-f94db721301b&quot;,&quot;parentUUID&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle large batch (1000 URLs - maximum allowed)&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests POST /api/shorten/bulk - Payload Size Tests should handle large batch (1000 URLs - maximum allowed)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(1000).fill().map((_, i) =&gt; `https://example.com/large-${i}`)\n\nconst mockDbResults = urls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `lg-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst startTime = Date.now()\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nconst endTime = Date.now()\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(1000)\nexpect(endTime - startTime).to.be.lessThan(10000) // Should complete within 10 seconds\n// Verify caching was attempted for all URLs\nexpect(mockRedisService.cacheUrl.callCount).to.equal(1000)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:181:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;f17d5d26-bef6-44e9-8c8f-0b638907f68d&quot;,&quot;parentUUID&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject batch exceeding maximum limit (1001 URLs)&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests POST /api/shorten/bulk - Payload Size Tests should reject batch exceeding maximum limit (1001 URLs)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(1001).fill(&#x27;https://example.com&#x27;)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;Too many URLs&#x27;)\nexpect(mockDatabaseService.getClient().$transaction).to.not.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Bulk operations are limited to 1000 Uâ€¦&#x27; to include &#x27;Too many URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Bulk operations are limited to 1000 Uâ€¦&#x27; to include &#x27;Too many URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:200:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;9787ad8e-796c-4aff-a440-95154f7f81d1&quot;,&quot;parentUUID&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle mixed valid and invalid URLs in large batch&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests POST /api/shorten/bulk - Payload Size Tests should handle mixed valid and invalid URLs in large batch&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrls = Array(500).fill().map((_, i) =&gt; `https://example.com/valid-${i}`)\nconst invalidUrls = Array(500).fill().map((_, i) =&gt; `invalid-url-${i}`)\nconst urls = [...validUrls, ...invalidUrls]\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;Invalid URL&#x27;)\nexpect(response.body.error.details).to.be.an(&#x27;array&#x27;)\nexpect(response.body.error.details).to.have.lengthOf(500) // All invalid URLs should be reported\nexpect(mockDatabaseService.getClient().$transaction).to.not.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;500 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;500 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:214:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;28cc3e92-9710-4f75-8fd7-82c79c5b43c8&quot;,&quot;parentUUID&quot;:&quot;69ce6004-39cb-4819-9411-f62f4f51a87f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;27cc5ee1-5e09-4f12-8025-eeea70b529aa&quot;,&quot;0ec53296-0bc2-44bf-a4c8-1c2d815c3901&quot;,&quot;ea11d0f6-9480-458d-af88-f94db721301b&quot;,&quot;f17d5d26-bef6-44e9-8c8f-0b638907f68d&quot;,&quot;9787ad8e-796c-4aff-a440-95154f7f81d1&quot;,&quot;28cc3e92-9710-4f75-8fd7-82c79c5b43c8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b854e17c-0f99-427b-b781-d8f690cd67a4&quot;,&quot;title&quot;:&quot;Bulk Operations Performance and Reliability&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-bulk-operations.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle duplicate URLs in bulk request efficiently&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Performance and Reliability should handle duplicate URLs in bulk request efficiently&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const baseUrl = &#x27;https://example.com/duplicate&#x27;\nconst urls = Array(100).fill(baseUrl) // All the same URL\n\nconst mockDbResults = urls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `dup-${index}`, // Different short codes for same URL\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(100)\n// Each duplicate should get a unique short code\nconst shortCodes = response.body.data.map(item =&gt; item.short_code)\nconst uniqueShortCodes = new Set(shortCodes)\nexpect(uniqueShortCodes.size).to.equal(100) // All should be unique&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:240:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;591bb72a-a4e1-4d20-bea7-5f8a5b3532c8&quot;,&quot;parentUUID&quot;:&quot;b854e17c-0f99-427b-b781-d8f690cd67a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle partial Redis failures during bulk caching&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Performance and Reliability should handle partial Redis failures during bulk caching&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(50).fill().map((_, i) =&gt; `https://example.com/cache-test-${i}`)\n\nconst mockDbResults = urls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `ct-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\n// Simulate intermittent caching failures\nmockRedisService.cacheUrl.callsFake(() =&gt; {\n  if (Math.random() &lt; 0.3) {\n    return Promise.reject(new Error(&#x27;Cache write failed&#x27;))\n  }\n  return Promise.resolve()\n})\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(50)\n// Should have warnings logged but operation should succeed\nexpect(mockLogger.warn.called).to.be.true&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:276:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;9e0d01e2-abdf-4c9e-ae19-d2b7dcfab757&quot;,&quot;parentUUID&quot;:&quot;b854e17c-0f99-427b-b781-d8f690cd67a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should maintain transaction atomicity on database failures&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Performance and Reliability should maintain transaction atomicity on database failures&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(20).fill().map((_, i) =&gt; `https://example.com/atomic-${i}`)\n// Simulate transaction failure\nmockDatabaseService.getClient().$transaction.rejects(new Error(&#x27;Transaction deadlock&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to create bulk short URLs&#x27;)\n// Verify no caching was attempted since transaction failed\nexpect(mockRedisService.cacheUrl).to.not.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:294:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;e3f048ec-b6b1-4387-93ab-de5fe3a1fc60&quot;,&quot;parentUUID&quot;:&quot;b854e17c-0f99-427b-b781-d8f690cd67a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle concurrent bulk requests&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Performance and Reliability should handle concurrent bulk requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const batchSize = 50\nconst numConcurrentRequests = 5\n// Create different URL sets for each request\nconst urlSets = Array(numConcurrentRequests).fill().map((_, setIndex) =&gt;\n  Array(batchSize).fill().map((_, urlIndex) =&gt; \n    `https://example.com/concurrent-${setIndex}-${urlIndex}`\n  )\n)\n// Mock successful responses for all requests\nurlSets.forEach((urls, setIndex) =&gt; {\n  const mockDbResults = urls.map((url, index) =&gt; ({\n    id: `test-id-${setIndex}-${index}`,\n    originalUrl: url,\n    shortCode: `cc-${setIndex}-${index}`,\n    createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n    expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n    clickCount: 0\n  }))\n  mockDatabaseService.getClient().$transaction\n    .onCall(setIndex).resolves(mockDbResults)\n})\n// Execute concurrent requests\nconst promises = urlSets.map(urls =&gt;\n  request(app)\n    .post(&#x27;/api/shorten/bulk&#x27;)\n    .send({ urls })\n)\nconst responses = await Promise.all(promises)\n// Verify all requests succeeded\nresponses.forEach((response, index) =&gt; {\n  expect(response.status).to.equal(201)\n  expect(response.body.success).to.be.true\n  expect(response.body.data).to.have.lengthOf(batchSize)\n})\n// Verify all transactions were called\nexpect(mockDatabaseService.getClient().$transaction.callCount).to.equal(numConcurrentRequests)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 503 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 503 to equal 201\n    at file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:339:36\n    at Array.forEach (&lt;anonymous&gt;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:338:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 503\n+ 201\n&quot;},&quot;uuid&quot;:&quot;4dc27f17-fd6e-4515-9300-5483aba539f7&quot;,&quot;parentUUID&quot;:&quot;b854e17c-0f99-427b-b781-d8f690cd67a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;591bb72a-a4e1-4d20-bea7-5f8a5b3532c8&quot;,&quot;9e0d01e2-abdf-4c9e-ae19-d2b7dcfab757&quot;,&quot;e3f048ec-b6b1-4387-93ab-de5fe3a1fc60&quot;,&quot;4dc27f17-fd6e-4515-9300-5483aba539f7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e4e7b2ea-bb2e-4b7b-a939-4bbe661f9b8c&quot;,&quot;title&quot;:&quot;Bulk Operations Error Handling&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-bulk-operations.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should provide detailed error information for validation failures&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Error Handling should provide detailed error information for validation failures&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://valid1.com&#x27;,\n  &#x27;invalid-url-1&#x27;,\n  &#x27;https://valid2.com&#x27;,\n  &#x27;ftp://invalid-protocol.com&#x27;,\n  &#x27;https://valid3.com&#x27;,\n  &#x27;invalid-url-2&#x27;\n]\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(400)\nexpect(response.body.error.details).to.be.an(&#x27;array&#x27;)\nexpect(response.body.error.details).to.have.lengthOf(3) // Three invalid URLs\n// Check that error details include specific invalid URLs\nconst errorDetails = response.body.error.details.join(&#x27; &#x27;)\nexpect(errorDetails).to.include(&#x27;invalid-url-1&#x27;)\nexpect(errorDetails).to.include(&#x27;ftp://invalid-protocol.com&#x27;)\nexpect(errorDetails).to.include(&#x27;invalid-url-2&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected [ â€¦(7) ] to have a length of 3 but got 7&quot;,&quot;estack&quot;:&quot;AssertionError: expected [ â€¦(7) ] to have a length of 3 but got 7\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:366:51)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 7\n+ 3\n&quot;},&quot;uuid&quot;:&quot;7729b011-571d-4fb6-8786-e14bed879a19&quot;,&quot;parentUUID&quot;:&quot;e4e7b2ea-bb2e-4b7b-a939-4bbe661f9b8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle malformed request payloads gracefully&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Error Handling should handle malformed request payloads gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .set(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)\n  .send(&#x27;{\&quot;urls\&quot;: [invalid json array}&#x27;)\n  .expect(400)\nexpect(response.body.error.code).to.equal(&#x27;BadRequest&#x27;)\nexpect(response.body.error.message).to.include(&#x27;Invalid JSON&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;code&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;code&#x27;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:382:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;5eb49efe-6af1-49e8-a632-749e0cf5ad8d&quot;,&quot;parentUUID&quot;:&quot;e4e7b2ea-bb2e-4b7b-a939-4bbe661f9b8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle extremely large individual URLs in bulk request&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Error Handling should handle extremely large individual URLs in bulk request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const normalUrls = Array(5).fill().map((_, i) =&gt; `https://example.com/normal-${i}`)\nconst extremelyLongUrl = &#x27;https://example.com/&#x27; + &#x27;a&#x27;.repeat(5000)\nconst urls = [...normalUrls, extremelyLongUrl]\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;URL too long&#x27;)\nexpect(response.body.error.details).to.be.an(&#x27;array&#x27;)\nexpect(response.body.error.details[0]).to.include(&#x27;https://example.com/aaa&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;URL too long&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;URL too long&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:396:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;8db7a1b9-ff49-4926-992e-87ceba59e7e8&quot;,&quot;parentUUID&quot;:&quot;e4e7b2ea-bb2e-4b7b-a939-4bbe661f9b8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate bulk request timeout behavior&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Bulk Operations Error Handling should validate bulk request timeout behavior&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(1000).fill().map((_, i) =&gt; `https://example.com/timeout-${i}`)\n// Simulate slow database transaction\nmockDatabaseService.getClient().$transaction.callsFake(() =&gt; {\n  return new Promise((resolve) =&gt; {\n    setTimeout(() =&gt; {\n      const mockDbResults = urls.map((url, index) =&gt; ({\n        id: `test-id-${index}`,\n        originalUrl: url,\n        shortCode: `to-${index}`,\n        createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n        expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n        clickCount: 0\n      }))\n      resolve(mockDbResults)\n    }, 100) // Small delay to simulate processing time\n  })\n})\nconst startTime = Date.now()\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .timeout(30000) // 30 second timeout\n  .expect(201)\nconst endTime = Date.now()\nexpect(response.body.success).to.be.true\nexpect(endTime - startTime).to.be.lessThan(30000) // Should complete within timeout&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:426:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;ba83d20d-1f22-4086-9d3d-7b457e7b9264&quot;,&quot;parentUUID&quot;:&quot;e4e7b2ea-bb2e-4b7b-a939-4bbe661f9b8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;7729b011-571d-4fb6-8786-e14bed879a19&quot;,&quot;5eb49efe-6af1-49e8-a632-749e0cf5ad8d&quot;,&quot;8db7a1b9-ff49-4926-992e-87ceba59e7e8&quot;,&quot;ba83d20d-1f22-4086-9d3d-7b457e7b9264&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8eaeab33-78e6-499f-bf37-0fc2500ea0aa&quot;,&quot;title&quot;:&quot;Edge Cases and Data Integrity&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-bulk-operations.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should maintain order of URLs in bulk response&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Edge Cases and Data Integrity should maintain order of URLs in bulk response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://first.com&#x27;,\n  &#x27;https://second.com&#x27;,\n  &#x27;https://third.com&#x27;,\n  &#x27;https://fourth.com&#x27;,\n  &#x27;https://fifth.com&#x27;\n]\nconst mockDbResults = urls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `order-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(201)\nexpect(response.body.success).to.be.true\n\n// Verify order is maintained\nresponse.body.data.forEach((item, index) =&gt; {\n  expect(item.original_url).to.equal(urls[index])\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:458:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;47353b36-2eb1-410d-99a8-7d6f859844d4&quot;,&quot;parentUUID&quot;:&quot;8eaeab33-78e6-499f-bf37-0fc2500ea0aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Unicode and special characters in bulk URLs&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Edge Cases and Data Integrity should handle Unicode and special characters in bulk URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com/æµ‹è¯•&#x27;,\n  &#x27;https://example.com/tÃ«st&#x27;,\n  &#x27;https://example.com/Ñ‚ÐµÑÑ‚&#x27;,\n  &#x27;https://example.com/ðŸš€&#x27;,\n  &#x27;https://example.com/path with spaces&#x27;,\n  &#x27;https://example.com/path?query=value&amp;param=æµ‹è¯•&#x27;\n]\n// These should be encoded properly for validation\nconst encodedUrls = urls.map(url =&gt; encodeURI(url))\nconst mockDbResults = encodedUrls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `unicode-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: encodedUrls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(encodedUrls.length)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:495:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;cb5c3bfd-b3d6-417a-94d5-773b914e972a&quot;,&quot;parentUUID&quot;:&quot;8eaeab33-78e6-499f-bf37-0fc2500ea0aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle empty strings and whitespace in URL array&quot;,&quot;fullTitle&quot;:&quot;API Bulk Operations Integration Tests Edge Cases and Data Integrity should handle empty strings and whitespace in URL array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://valid1.com&#x27;,\n  &#x27;&#x27;,\n  &#x27;   &#x27;,\n  &#x27;https://valid2.com&#x27;,\n  &#x27;\\t\\n&#x27;,\n  &#x27;https://valid3.com&#x27;\n]\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;Invalid URL&#x27;)\nexpect(response.body.error.details).to.be.an(&#x27;array&#x27;)\nexpect(response.body.error.details).to.have.lengthOf(3) // Three empty/whitespace URLs&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;3 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;3 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-bulk-operations.test.js:516:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;54083e08-6f62-4561-b758-b6c18d982e07&quot;,&quot;parentUUID&quot;:&quot;8eaeab33-78e6-499f-bf37-0fc2500ea0aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;47353b36-2eb1-410d-99a8-7d6f859844d4&quot;,&quot;cb5c3bfd-b3d6-417a-94d5-773b914e972a&quot;,&quot;54083e08-6f62-4561-b758-b6c18d982e07&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2913d9e7-e246-4bc4-8707-e1fa8c8b1481&quot;,&quot;title&quot;:&quot;API Resilience Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests \&quot;before all\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox()\n\n// Create Express app\napp = express()\napp.use(express.json())\n// Mock services\nmockDatabaseService = {\n  getClient: sandbox.stub().returns({\n    url: {\n      create: sandbox.stub(),\n      findUnique: sandbox.stub(),\n      findMany: sandbox.stub(),\n      delete: sandbox.stub(),\n      update: sandbox.stub()\n    },\n    $transaction: sandbox.stub()\n  }),\n  healthCheck: sandbox.stub().resolves(true)\n}\nmockRedisService = {\n  getShortCode: sandbox.stub(),\n  cacheUrl: sandbox.stub(),\n  getCachedUrl: sandbox.stub(),\n  removeCachedUrl: sandbox.stub(),\n  isHealthy: sandbox.stub().returns(true)\n}\nmockLogger = {\n  debug: sandbox.stub(),\n  info: sandbox.stub(),\n  warn: sandbox.stub(),\n  error: sandbox.stub(),\n  fatal: sandbox.stub()\n}\n// Use test routes with mocked dependencies\napp.use(&#x27;/api&#x27;, createApiRoutes(mockDatabaseService, mockRedisService, mockLogger))&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9e767452-137f-41b5-8eb8-eb34d4707c78&quot;,&quot;parentUUID&quot;:&quot;2913d9e7-e246-4bc4-8707-e1fa8c8b1481&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests \&quot;before each\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.resetHistory()\n// Reset health status\nmockRedisService.isHealthy.returns(true)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d6539b19-ad10-4594-85eb-e26d1093473f&quot;,&quot;parentUUID&quot;:&quot;2913d9e7-e246-4bc4-8707-e1fa8c8b1481&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests \&quot;after all\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4d5283ef-d75b-45e7-863b-e38dfe4943c4&quot;,&quot;parentUUID&quot;:&quot;2913d9e7-e246-4bc4-8707-e1fa8c8b1481&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests \&quot;after each\&quot; hook in \&quot;API Resilience Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.resetHistory()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;60e9dfdc-37e8-427f-a12b-c30d32534986&quot;,&quot;parentUUID&quot;:&quot;2913d9e7-e246-4bc4-8707-e1fa8c8b1481&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;69ff1241-2cf2-4891-9a2e-e27f9d85ce80&quot;,&quot;title&quot;:&quot;Redis Failure Scenarios&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fe7bc645-8b23-40c1-8736-c85cf07b355f&quot;,&quot;title&quot;:&quot;POST /api/shorten - Redis Failures&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle Redis short code generation failure gracefully&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios POST /api/shorten - Redis Failures should handle Redis short code generation failure gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.rejects(new Error(&#x27;Redis connection timeout&#x27;))\nmockDatabaseService.getClient().url.create.resolves(mockDbResult)\nmockRedisService.cacheUrl.resolves() // Cache might still work\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.short_code).to.equal(fallbackShortCode)\n// Verify fallback was used and warning logged\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Redis.*failed.*fallback/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:97:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;cf4fbb9f-df32-4f53-82ea-f4343c284bd3&quot;,&quot;parentUUID&quot;:&quot;fe7bc645-8b23-40c1-8736-c85cf07b355f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis caching failure without affecting URL creation&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios POST /api/shorten - Redis Failures should handle Redis caching failure without affecting URL creation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.resolves(&#x27;abc123&#x27;)\nmockDatabaseService.getClient().url.create.resolves(mockDbResult)\nmockRedisService.cacheUrl.rejects(new Error(&#x27;Redis write failed&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Failed to cache.*continuing/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:117:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;9d03c944-84ea-473d-ab13-27c94bf0e195&quot;,&quot;parentUUID&quot;:&quot;fe7bc645-8b23-40c1-8736-c85cf07b355f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle complete Redis service failure&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios POST /api/shorten - Redis Failures should handle complete Redis service failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.rejects(new Error(&#x27;Redis unavailable&#x27;))\nmockRedisService.cacheUrl.rejects(new Error(&#x27;Redis unavailable&#x27;))\nmockRedisService.isHealthy.returns(false)\nmockDatabaseService.getClient().url.create.resolves(mockDbResult)\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(mockLogger.warn.callCount).to.be.greaterThan(0)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:135:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;bb1fb447-8e12-4bad-8832-0c870421237a&quot;,&quot;parentUUID&quot;:&quot;fe7bc645-8b23-40c1-8736-c85cf07b355f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;cf4fbb9f-df32-4f53-82ea-f4343c284bd3&quot;,&quot;9d03c944-84ea-473d-ab13-27c94bf0e195&quot;,&quot;bb1fb447-8e12-4bad-8832-0c870421237a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d2df48b3-327e-4461-9120-2aae5ec17423&quot;,&quot;title&quot;:&quot;GET /api/url/:shortCode - Redis Cache Failures&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fallback to database when Redis cache lookup fails&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios GET /api/url/:shortCode - Redis Cache Failures should fallback to database when Redis cache lookup fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getCachedUrl.rejects(new Error(&#x27;Redis connection lost&#x27;))\nmockDatabaseService.getClient().url.findUnique.resolves(mockDbResult)\nmockRedisService.cacheUrl.resolves() // Re-caching might work\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.original_url).to.equal(originalUrl)\n// Should have fallen back to database\nexpect(mockDatabaseService.getClient().url.findUnique).to.have.been.called\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Cache lookup failed.*falling back to database/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:162:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;abda3de0-21b1-4398-b9ad-fe453737e21d&quot;,&quot;parentUUID&quot;:&quot;d2df48b3-327e-4461-9120-2aae5ec17423&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis re-caching failure after database retrieval&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios GET /api/url/:shortCode - Redis Cache Failures should handle Redis re-caching failure after database retrieval&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getCachedUrl.resolves(null) // Cache miss\nmockDatabaseService.getClient().url.findUnique.resolves(mockDbResult)\nmockRedisService.cacheUrl.rejects(new Error(&#x27;Redis write timeout&#x27;))\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body.success).to.be.true\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Failed to cache.*after database retrieval/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:182:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;3e7cd1e2-8eac-436a-a89d-40b6c77cbec0&quot;,&quot;parentUUID&quot;:&quot;d2df48b3-327e-4461-9120-2aae5ec17423&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;abda3de0-21b1-4398-b9ad-fe453737e21d&quot;,&quot;3e7cd1e2-8eac-436a-a89d-40b6c77cbec0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;47607751-061e-42a3-9e41-5e7ed3af081a&quot;,&quot;title&quot;:&quot;DELETE /api/url/:shortCode - Redis Cache Invalidation Failures&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle Redis cache invalidation failure gracefully&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios DELETE /api/url/:shortCode - Redis Cache Invalidation Failures should handle Redis cache invalidation failure gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.delete.resolves(mockDbResult)\nmockRedisService.removeCachedUrl.rejects(new Error(&#x27;Redis remove failed&#x27;))\nconst response = await request(app)\n  .delete(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.short_code).to.equal(shortCode)\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Failed to remove.*from cache/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:211:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;1b4f9ebd-d36a-490a-9013-cc0a45ddd4e7&quot;,&quot;parentUUID&quot;:&quot;47607751-061e-42a3-9e41-5e7ed3af081a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1b4f9ebd-d36a-490a-9013-cc0a45ddd4e7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;688eda53-54ba-4d7e-bcb4-c45bc70e6d22&quot;,&quot;title&quot;:&quot;POST /api/shorten/bulk - Redis Failures in Bulk Operations&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle Redis short code generation failure in bulk operations&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios POST /api/shorten/bulk - Redis Failures in Bulk Operations should handle Redis short code generation failure in bulk operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.rejects(new Error(&#x27;Redis pool empty&#x27;))\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nmockRedisService.cacheUrl.resolves()\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: validUrls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(3)\nexpect(mockLogger.warn).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:247:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;52b53f07-0bcf-4c5c-90a0-63e0d0ed9973&quot;,&quot;parentUUID&quot;:&quot;688eda53-54ba-4d7e-bcb4-c45bc70e6d22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle partial Redis caching failures in bulk operations&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Redis Failure Scenarios POST /api/shorten/bulk - Redis Failures in Bulk Operations should handle partial Redis caching failures in bulk operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.resolves(&#x27;bulk-code&#x27;)\nmockDatabaseService.getClient().$transaction.resolves(mockDbResults)\n\n// Simulate intermittent caching failures\nlet cacheCallCount = 0\nmockRedisService.cacheUrl.callsFake(() =&gt; {\n  cacheCallCount++\n  if (cacheCallCount % 2 === 0) {\n    return Promise.reject(new Error(&#x27;Cache write failed&#x27;))\n  }\n  return Promise.resolve()\n})\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: validUrls })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data).to.have.lengthOf(3)\n// Should have warnings but operation succeeds\nexpect(mockLogger.warn.called).to.be.true&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:271:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;76ba6dbd-a911-4cfd-ac40-3fc0f443f3b7&quot;,&quot;parentUUID&quot;:&quot;688eda53-54ba-4d7e-bcb4-c45bc70e6d22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;52b53f07-0bcf-4c5c-90a0-63e0d0ed9973&quot;,&quot;76ba6dbd-a911-4cfd-ac40-3fc0f443f3b7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;07fca73c-cd13-4da5-a23a-1e4b923faa78&quot;,&quot;title&quot;:&quot;Database Failure Scenarios&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7d28492e-f7e2-4f4d-907b-2b7f2b6360b4&quot;,&quot;title&quot;:&quot;Database Connection Failures&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle database connection failure in POST /api/shorten&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Connection Failures should handle database connection failure in POST /api/shorten&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.resolves(&#x27;abc123&#x27;)\nmockDatabaseService.getClient().url.create.rejects(new Error(&#x27;ECONNREFUSED&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;https://example.com/db-test&#x27; })\n  .expect(500)\nexpect(response.body.status_code).to.equal(500)\nexpect(response.body.error.code).to.equal(&#x27;InternalServerError&#x27;)\nexpect(response.body.error.message).to.include(&#x27;Failed to create short URL&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:291:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;1582b5af-fde3-4dec-9321-c70278752916&quot;,&quot;parentUUID&quot;:&quot;7d28492e-f7e2-4f4d-907b-2b7f2b6360b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database connection failure in GET /api/url/:shortCode&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Connection Failures should handle database connection failure in GET /api/url/:shortCode&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getCachedUrl.resolves(null) // Cache miss\nmockDatabaseService.getClient().url.findUnique.rejects(new Error(&#x27;Database connection lost&#x27;))\nconst response = await request(app)\n  .get(&#x27;/api/url/abc123&#x27;)\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to retrieve URL&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:304:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;29d101e2-a461-488b-afa5-5deef7da42fd&quot;,&quot;parentUUID&quot;:&quot;7d28492e-f7e2-4f4d-907b-2b7f2b6360b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database connection failure in DELETE /api/url/:shortCode&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Connection Failures should handle database connection failure in DELETE /api/url/:shortCode&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.delete.rejects(new Error(&#x27;Connection timed out&#x27;))\nconst response = await request(app)\n  .delete(&#x27;/api/url/abc123&#x27;)\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to delete URL&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:314:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;5e98c1c1-a929-4331-969a-7db72571d17f&quot;,&quot;parentUUID&quot;:&quot;7d28492e-f7e2-4f4d-907b-2b7f2b6360b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database connection failure in GET /api/urls&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Connection Failures should handle database connection failure in GET /api/urls&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findMany.rejects(new Error(&#x27;Database unavailable&#x27;))\nconst response = await request(app)\n  .get(&#x27;/api/urls&#x27;)\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to retrieve URLs&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Failed to retrieve URL list&#x27; to include &#x27;Failed to retrieve URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Failed to retrieve URL list&#x27; to include &#x27;Failed to retrieve URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:326:48)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;17221e96-9248-427f-ad24-8379c26232fa&quot;,&quot;parentUUID&quot;:&quot;7d28492e-f7e2-4f4d-907b-2b7f2b6360b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1582b5af-fde3-4dec-9321-c70278752916&quot;,&quot;29d101e2-a461-488b-afa5-5deef7da42fd&quot;,&quot;5e98c1c1-a929-4331-969a-7db72571d17f&quot;,&quot;17221e96-9248-427f-ad24-8379c26232fa&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2d0427af-4e27-457e-84f5-7dee06184d61&quot;,&quot;title&quot;:&quot;Database Transaction Failures&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle transaction deadlock in bulk operations&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Transaction Failures should handle transaction deadlock in bulk operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [&#x27;https://example.com/tx-1&#x27;, &#x27;https://example.com/tx-2&#x27;]\n\nmockRedisService.getShortCode.resolves(&#x27;tx-code&#x27;)\nmockDatabaseService.getClient().$transaction.rejects(new Error(&#x27;Transaction deadlock detected&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to create bulk short URLs&#x27;)\nexpect(mockLogger.error).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:340:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;b5381e7e-7cab-41e1-8637-0552e1d2ecce&quot;,&quot;parentUUID&quot;:&quot;2d0427af-4e27-457e-84f5-7dee06184d61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle transaction timeout in bulk operations&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Transaction Failures should handle transaction timeout in bulk operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = Array(100).fill().map((_, i) =&gt; `https://example.com/timeout-${i}`)\n\nmockRedisService.getShortCode.resolves(&#x27;timeout-code&#x27;)\nmockDatabaseService.getClient().$transaction.rejects(new Error(&#x27;Transaction timeout&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls })\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to create bulk short URLs&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:355:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;517a9b48-4ff2-41e4-be25-a10e0da03899&quot;,&quot;parentUUID&quot;:&quot;2d0427af-4e27-457e-84f5-7dee06184d61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;b5381e7e-7cab-41e1-8637-0552e1d2ecce&quot;,&quot;517a9b48-4ff2-41e4-be25-a10e0da03899&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7511c20b-bb18-4d24-a60a-201087bd69a2&quot;,&quot;title&quot;:&quot;Database Constraint Violations&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle unique constraint violation with retry logic&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Constraint Violations should handle unique constraint violation with retry logic&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrl = &#x27;https://example.com/constraint-test&#x27;\nconst duplicateError = new Error(&#x27;Unique constraint failed&#x27;)\nduplicateError.code = &#x27;P2002&#x27;\nconst successResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: &#x27;retry-123&#x27;,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}\nmockRedisService.getShortCode\n  .onFirstCall().resolves(&#x27;duplicate-code&#x27;)\n  .onSecondCall().resolves(&#x27;retry-123&#x27;)\nmockDatabaseService.getClient().url.create\n  .onFirstCall().rejects(duplicateError)\n  .onSecondCall().resolves(successResult)\nmockRedisService.cacheUrl.resolves()\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.short_code).to.equal(&#x27;retry-123&#x27;)\n// Should have logged the retry\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Duplicate short code.*retrying/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:389:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;419aae65-1f1f-4fe5-be49-3867e222ccfd&quot;,&quot;parentUUID&quot;:&quot;7511c20b-bb18-4d24-a60a-201087bd69a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail after maximum retry attempts&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Database Failure Scenarios Database Constraint Violations should fail after maximum retry attempts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrl = &#x27;https://example.com/max-retry-test&#x27;\nconst duplicateError = new Error(&#x27;Unique constraint failed&#x27;)\nduplicateError.code = &#x27;P2002&#x27;\nmockRedisService.getShortCode.resolves(&#x27;always-duplicate&#x27;)\nmockDatabaseService.getClient().url.create.rejects(duplicateError)\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to create short URL after retries&#x27;)\nexpect(mockDatabaseService.getClient().url.create.callCount).to.equal(3) // Max retries&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:412:12)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;cf7063de-a3b8-44d4-837b-c686211f8110&quot;,&quot;parentUUID&quot;:&quot;7511c20b-bb18-4d24-a60a-201087bd69a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;419aae65-1f1f-4fe5-be49-3867e222ccfd&quot;,&quot;cf7063de-a3b8-44d4-837b-c686211f8110&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a7bb55d7-ff09-49a7-b0f2-ee5bf5a6a0de&quot;,&quot;title&quot;:&quot;Combined Redis and Database Failures&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle simultaneous Redis and database failures gracefully&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Combined Redis and Database Failures should handle simultaneous Redis and database failures gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode.rejects(new Error(&#x27;Redis unavailable&#x27;))\nmockRedisService.cacheUrl.rejects(new Error(&#x27;Redis unavailable&#x27;))\nmockRedisService.getCachedUrl.rejects(new Error(&#x27;Redis unavailable&#x27;))\nmockDatabaseService.getClient().url.create.rejects(new Error(&#x27;Database unavailable&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;https://example.com/total-failure&#x27; })\n  .expect(500)\nexpect(response.body.error.code).to.equal(&#x27;InternalServerError&#x27;)\n\n// Should have logged both Redis and database failures\nexpect(mockLogger.warn.called).to.be.true\nexpect(mockLogger.error.called).to.be.true&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:430:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;374d0197-d6d4-447a-836b-36f992ec5157&quot;,&quot;parentUUID&quot;:&quot;a7bb55d7-ff09-49a7-b0f2-ee5bf5a6a0de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should prioritize database operations when Redis fails&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Combined Redis and Database Failures should prioritize database operations when Redis fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const shortCode = &#x27;priority-test&#x27;\nconst originalUrl = &#x27;https://example.com/priority-test&#x27;\nconst mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: originalUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 10\n}\n// Redis completely fails\nmockRedisService.getCachedUrl.rejects(new Error(&#x27;Redis down&#x27;))\nmockRedisService.cacheUrl.rejects(new Error(&#x27;Redis down&#x27;))\n\n// Database works\nmockDatabaseService.getClient().url.findUnique.resolves(mockDbResult)\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.original_url).to.equal(originalUrl)\n// Should have warned about Redis but succeeded with database\nexpect(mockLogger.warn).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:461:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;c6ebd7b7-4d41-493c-afdb-100fa52d87f4&quot;,&quot;parentUUID&quot;:&quot;a7bb55d7-ff09-49a7-b0f2-ee5bf5a6a0de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;374d0197-d6d4-447a-836b-36f992ec5157&quot;,&quot;c6ebd7b7-4d41-493c-afdb-100fa52d87f4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;437ff8a9-c1f6-4fe5-a7df-8cfebc628c74&quot;,&quot;title&quot;:&quot;Network and Timeout Scenarios&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle slow database responses&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Network and Timeout Scenarios should handle slow database responses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrl = &#x27;https://example.com/slow-db&#x27;\n\nmockRedisService.getShortCode.resolves(&#x27;slow-123&#x27;)\n\n// Simulate slow database response\nmockDatabaseService.getClient().url.create.callsFake(() =&gt; {\n  return new Promise((resolve) =&gt; {\n    setTimeout(() =&gt; {\n      resolve({\n        id: &#x27;test-id&#x27;,\n        originalUrl: validUrl,\n        shortCode: &#x27;slow-123&#x27;,\n        createdAt: new Date(),\n        expiresAt: new Date(),\n        clickCount: 0\n      })\n    }, 200) // 200ms delay\n  })\n})\nmockRedisService.cacheUrl.resolves()\nconst startTime = Date.now()\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .timeout(5000)\n  .expect(201)\nconst endTime = Date.now()\nexpect(response.body.success).to.be.true\nexpect(endTime - startTime).to.be.greaterThan(200)\nexpect(endTime - startTime).to.be.lessThan(1000)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:500:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;66c06d8c-42c1-4773-b42b-c0145567cf98&quot;,&quot;parentUUID&quot;:&quot;437ff8a9-c1f6-4fe5-a7df-8cfebc628c74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis timeout with database fallback&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Network and Timeout Scenarios should handle Redis timeout with database fallback&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const shortCode = &#x27;timeout-test&#x27;\nconst originalUrl = &#x27;https://example.com/timeout-test&#x27;\n// Redis times out\nmockRedisService.getCachedUrl.callsFake(() =&gt; {\n  return new Promise((_, reject) =&gt; {\n    setTimeout(() =&gt; reject(new Error(&#x27;Redis timeout&#x27;)), 100)\n  })\n})\n// Database responds normally\nmockDatabaseService.getClient().url.findUnique.resolves({\n  id: &#x27;test-id&#x27;,\n  originalUrl: originalUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 25\n})\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.original_url).to.equal(originalUrl)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:531:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;a705d1c8-aa5b-439a-badf-efab22d6168e&quot;,&quot;parentUUID&quot;:&quot;437ff8a9-c1f6-4fe5-a7df-8cfebc628c74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;66c06d8c-42c1-4773-b42b-c0145567cf98&quot;,&quot;a705d1c8-aa5b-439a-badf-efab22d6168e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;58abb3a0-8db1-4c0c-9ae7-97950a95e430&quot;,&quot;title&quot;:&quot;Service Health Monitoring&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api-resilience.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should continue operations when Redis health check fails&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Service Health Monitoring should continue operations when Redis health check fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.isHealthy.returns(false)\nmockRedisService.getShortCode.rejects(new Error(&#x27;Redis unhealthy&#x27;))\n\nconst mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: &#x27;https://example.com/health-test&#x27;,\n  shortCode: &#x27;health-123&#x27;,\n  createdAt: new Date(),\n  expiresAt: new Date(),\n  clickCount: 0\n}\nmockDatabaseService.getClient().url.create.resolves(mockDbResult)\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;https://example.com/health-test&#x27; })\n  .expect(201)\nexpect(response.body.success).to.be.true\nexpect(mockLogger.warn).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:557:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;17a1bc20-7c4b-4445-803a-9501efbf0631&quot;,&quot;parentUUID&quot;:&quot;58abb3a0-8db1-4c0c-9ae7-97950a95e430&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should log appropriate error levels for different failure types&quot;,&quot;fullTitle&quot;:&quot;API Resilience Integration Tests Service Health Monitoring should log appropriate error levels for different failure types&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Test various failure scenarios to ensure proper logging\n\n// Redis warning-level failure\nmockRedisService.cacheUrl.rejects(new Error(&#x27;Cache write failed&#x27;))\nmockRedisService.getShortCode.resolves(&#x27;log-test&#x27;)\nmockDatabaseService.getClient().url.create.resolves({\n  id: &#x27;test-id&#x27;,\n  originalUrl: &#x27;https://example.com/log-test&#x27;,\n  shortCode: &#x27;log-test&#x27;,\n  createdAt: new Date(),\n  expiresAt: new Date(),\n  clickCount: 0\n})\nawait request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;https://example.com/log-test&#x27; })\n  .expect(201)\nexpect(mockLogger.warn).to.have.been.called\nexpect(mockLogger.error).to.not.have.been.called\n// Reset for next test\nsandbox.resetHistory()\n// Database error-level failure\nmockDatabaseService.getClient().url.create.rejects(new Error(&#x27;Database error&#x27;))\nawait request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;https://example.com/db-error&#x27; })\n  .expect(500)\nexpect(mockLogger.error).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api-resilience.test.js:581:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;5aaf7dfa-50b9-4474-9870-5f3a665f4a01&quot;,&quot;parentUUID&quot;:&quot;58abb3a0-8db1-4c0c-9ae7-97950a95e430&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;17a1bc20-7c4b-4445-803a-9501efbf0631&quot;,&quot;5aaf7dfa-50b9-4474-9870-5f3a665f4a01&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5edf3bfb-bbe4-430f-8012-632db8295eaf&quot;,&quot;title&quot;:&quot;API Endpoints Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests \&quot;before all\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox()\n\n// Create Express app\napp = express()\napp.use(express.json())\n// Mock services\nmockDatabaseService = {\n  getClient: sandbox.stub().returns({\n    url: {\n      create: sandbox.stub(),\n      findUnique: sandbox.stub(),\n      findMany: sandbox.stub(),\n      delete: sandbox.stub(),\n      update: sandbox.stub()\n    },\n    $transaction: sandbox.stub()\n  }),\n  healthCheck: sandbox.stub().resolves(true)\n}\nmockRedisService = {\n  getShortCode: sandbox.stub(),\n  cacheUrl: sandbox.stub(),\n  getCachedUrl: sandbox.stub(),\n  removeCachedUrl: sandbox.stub(),\n  isHealthy: sandbox.stub().returns(true)\n}\nmockLogger = {\n  debug: sandbox.stub(),\n  info: sandbox.stub(),\n  warn: sandbox.stub(),\n  error: sandbox.stub(),\n  fatal: sandbox.stub()\n}\n// Use test routes with mocked dependencies\napp.use(&#x27;/api&#x27;, createApiRoutes(mockDatabaseService, mockRedisService, mockLogger))&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e8cc05f-4d9c-4e37-9bf1-f270f0288604&quot;,&quot;parentUUID&quot;:&quot;5edf3bfb-bbe4-430f-8012-632db8295eaf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests \&quot;before each\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.resetHistory()\n// Set up common mocks\nmockRedisService.getShortCode.resolves(&#x27;abc123&#x27;)\nmockRedisService.cacheUrl.resolves()\nmockRedisService.getCachedUrl.resolves(null)\nmockRedisService.removeCachedUrl.resolves()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c2a803d9-4856-462a-bbe1-30733d0b15dd&quot;,&quot;parentUUID&quot;:&quot;5edf3bfb-bbe4-430f-8012-632db8295eaf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests \&quot;after all\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4ba97962-89b2-453f-95a9-9465fa172df4&quot;,&quot;parentUUID&quot;:&quot;5edf3bfb-bbe4-430f-8012-632db8295eaf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests \&quot;after each\&quot; hook in \&quot;API Endpoints Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.resetHistory()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1025eb34-c6db-46a3-975a-6dec0181890d&quot;,&quot;parentUUID&quot;:&quot;5edf3bfb-bbe4-430f-8012-632db8295eaf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;title&quot;:&quot;POST /api/shorten&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully create a short URL&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should successfully create a short URL&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.create.resolves(mockDbResult)\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(201)\nexpect(response.body).to.deep.equal({\n  success: true,\n  data: {\n    original_url: validUrl,\n    short_url: `http://localhost:3000/${shortCode}`,\n    short_code: shortCode,\n    created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n    expires_at: &#x27;2024-07-15T10:30:00.000Z&#x27;\n  }\n})\nexpect(mockDatabaseService.getClient().url.create).to.have.been.calledOnce\nexpect(mockRedisService.cacheUrl).to.have.been.calledWith(shortCode, validUrl)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:100:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;9cd4c501-e761-4db4-8868-3269064ec8de&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing URL&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should return 400 for missing URL&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({})\n  .expect(400)\nexpect(response.body).to.have.property(&#x27;status_code&#x27;, 400)\nexpect(response.body).to.have.property(&#x27;error&#x27;)\nexpect(response.body.error.code).to.equal(&#x27;BadRequest&#x27;)\nexpect(response.body.error.message).to.include(&#x27;URL is required&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;INVALID_REQUEST_BODY&#x27; to equal &#x27;BadRequest&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;INVALID_REQUEST_BODY&#x27; to equal &#x27;BadRequest&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:125:43)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- INVALID_REQUEST_BODY\n+ BadRequest\n&quot;},&quot;uuid&quot;:&quot;6336b67b-60da-43c2-b82d-89e2024e4b99&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid URL format&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should return 400 for invalid URL format&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;not-a-url&#x27; })\n  .expect(400)\nexpect(response.body).to.have.property(&#x27;status_code&#x27;, 400)\nexpect(response.body.error.code).to.equal(&#x27;BadRequest&#x27;)\nexpect(response.body.error.message).to.include(&#x27;Invalid URL format&#x27;)\nexpect(mockDatabaseService.getClient().url.create).to.not.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;INVALID_URL&#x27; to equal &#x27;BadRequest&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;INVALID_URL&#x27; to equal &#x27;BadRequest&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:136:43)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- INVALID_URL\n+ BadRequest\n&quot;},&quot;uuid&quot;:&quot;add064c0-00b0-4e6a-8d6d-25c854ec6f55&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for URL that is too long&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should return 400 for URL that is too long&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const longUrl = &#x27;https://example.com/&#x27; + &#x27;a&#x27;.repeat(3000)\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: longUrl })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;URL too long&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;URL exceeds maximum length of 2048 châ€¦&#x27; to include &#x27;URL too long&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;URL exceeds maximum length of 2048 châ€¦&#x27; to include &#x27;URL too long&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:149:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;e81311e1-f323-4219-add0-f30d650147d8&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for database failure&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should return 500 for database failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.create.rejects(new Error(&#x27;Database connection failed&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(500)\nexpect(response.body).to.have.property(&#x27;status_code&#x27;, 500)\nexpect(response.body.error.code).to.equal(&#x27;InternalServerError&#x27;)\nexpect(response.body.error.message).to.include(&#x27;Failed to create short URL&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:158:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;28bb498c-1543-4090-bb75-d950f701a1ef&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle malformed JSON request&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should handle malformed JSON request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .set(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)\n  .send(&#x27;{\&quot;url\&quot;: invalid json}&#x27;)\n  .expect(400)\nexpect(response.body.error.code).to.equal(&#x27;BadRequest&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;code&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;code&#x27;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:172:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;49a42222-4ded-4040-8f2a-af8ad12c2f7b&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject non-HTTP protocols&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten should reject non-HTTP protocols&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: &#x27;ftp://example.com&#x27; })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;Only HTTP and HTTPS protocols are allowed&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;URL must use one of the allowed protoâ€¦&#x27; to include &#x27;Only HTTP and HTTPS protocols are allâ€¦&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;URL must use one of the allowed protoâ€¦&#x27; to include &#x27;Only HTTP and HTTPS protocols are allâ€¦&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:181:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;50b9135e-10b7-4064-8c3a-899b2074ec30&quot;,&quot;parentUUID&quot;:&quot;d07e809d-fae4-4b7f-9258-23ce760e3a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;9cd4c501-e761-4db4-8868-3269064ec8de&quot;,&quot;6336b67b-60da-43c2-b82d-89e2024e4b99&quot;,&quot;add064c0-00b0-4e6a-8d6d-25c854ec6f55&quot;,&quot;e81311e1-f323-4219-add0-f30d650147d8&quot;,&quot;28bb498c-1543-4090-bb75-d950f701a1ef&quot;,&quot;49a42222-4ded-4040-8f2a-af8ad12c2f7b&quot;,&quot;50b9135e-10b7-4064-8c3a-899b2074ec30&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;title&quot;:&quot;POST /api/shorten/bulk&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /api/shorten/bulk\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk \&quot;before each\&quot; hook in \&quot;POST /api/shorten/bulk\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getShortCode\n  .onFirstCall().resolves(shortCodes[0])\n  .onSecondCall().resolves(shortCodes[1])\n  .onThirdCall().resolves(shortCodes[2])&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e8bec37c-0fd4-433b-93e1-81d5a0d04c2a&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully create multiple short URLs&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should successfully create multiple short URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().$transaction.resolves(mockDbResults)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: validUrls })\n  .expect(201)\nexpect(response.body).to.have.property(&#x27;success&#x27;, true)\nexpect(response.body.data).to.be.an(&#x27;array&#x27;).with.lengthOf(3)\n\nresponse.body.data.forEach((item, index) =&gt; {\n  expect(item).to.deep.equal({\n    original_url: validUrls[index],\n    short_url: `http://localhost:3000/${shortCodes[index]}`,\n    short_code: shortCodes[index]\n  })\n})\nexpect(mockDatabaseService.getClient().$transaction).to.have.been.calledOnce&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:215:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;c45a7938-8962-4e21-bb26-cb7d734ce431&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing URLs array&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should return 400 for missing URLs array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({})\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;URLs array is required&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Request body is required&#x27; to include &#x27;URLs array is required&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Request body is required&#x27; to include &#x27;URLs array is required&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:237:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;2c1aca27-41b7-4c9c-a9e8-d55d31718730&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for empty URLs array&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should return 400 for empty URLs array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: [] })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;URLs array cannot be empty&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4dc13387-d5e1-40db-adbd-fe0c1c564d88&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for too many URLs&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should return 400 for too many URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tooManyUrls = new Array(1001).fill(&#x27;https://example.com&#x27;)\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: tooManyUrls })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;Too many URLs&#x27;)\nexpect(mockDatabaseService.getClient().$transaction).to.not.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Bulk operations are limited to 1000 Uâ€¦&#x27; to include &#x27;Too many URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Bulk operations are limited to 1000 Uâ€¦&#x27; to include &#x27;Too many URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:257:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;a0b8b761-3db8-469c-ad51-1b6c3720f204&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid URLs in array&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should return 400 for invalid URLs in array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mixedUrls = [\n  &#x27;https://example.com/valid&#x27;,\n  &#x27;invalid-url&#x27;,\n  &#x27;https://example.com/also-valid&#x27;\n]\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: mixedUrls })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;Invalid URL&#x27;)\nexpect(response.body.error.details).to.be.an(&#x27;array&#x27;)\nexpect(response.body.error.details.some(detail =&gt; detail.includes(&#x27;invalid-url&#x27;))).to.be.true&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:273:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;bc4601f2-f09e-41b7-a7f5-c90571ffb120&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for database transaction failure&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should return 500 for database transaction failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().$transaction.rejects(new Error(&#x27;Transaction failed&#x27;))\nconst response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: validUrls })\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to create bulk short URLs&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:284:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;e80fc996-4435-41c3-a0d7-c5f7f8ad5d84&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-array URLs field&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests POST /api/shorten/bulk should handle non-array URLs field&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten/bulk&#x27;)\n  .send({ urls: &#x27;not-an-array&#x27; })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;URLs must be an array&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;URLs must be provided as an array&#x27; to include &#x27;URLs must be an array&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;URLs must be provided as an array&#x27; to include &#x27;URLs must be an array&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:295:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;30ea1972-2fcf-410f-974b-b2e5b74e31db&quot;,&quot;parentUUID&quot;:&quot;71574d4e-0b02-4414-b3b2-28bddf38305d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4dc13387-d5e1-40db-adbd-fe0c1c564d88&quot;],&quot;failures&quot;:[&quot;c45a7938-8962-4e21-bb26-cb7d734ce431&quot;,&quot;2c1aca27-41b7-4c9c-a9e8-d55d31718730&quot;,&quot;a0b8b761-3db8-469c-ad51-1b6c3720f204&quot;,&quot;bc4601f2-f09e-41b7-a7f5-c90571ffb120&quot;,&quot;e80fc996-4435-41c3-a0d7-c5f7f8ad5d84&quot;,&quot;30ea1972-2fcf-410f-974b-b2e5b74e31db&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;76ba43dd-2a79-4e2c-9bcd-3ea8ef919619&quot;,&quot;title&quot;:&quot;GET /api/url/:shortCode&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return URL details from database&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/url/:shortCode should return URL details from database&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findUnique.resolves(mockDbResult)\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body).to.deep.equal({\n  success: true,\n  data: {\n    original_url: originalUrl,\n    short_code: shortCode,\n    created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n    expires_at: &#x27;2024-07-15T10:30:00.000Z&#x27;,\n    click_count: 42\n  }\n})\nexpect(mockDatabaseService.getClient().url.findUnique).to.have.been.calledWith({\n  where: { shortCode: shortCode }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:317:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;7b7eb158-bc58-4530-98e8-6be13a02596b&quot;,&quot;parentUUID&quot;:&quot;76ba43dd-2a79-4e2c-9bcd-3ea8ef919619&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return URL details from cache when available&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/url/:shortCode should return URL details from cache when available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedisService.getCachedUrl.resolves(originalUrl)\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body.success).to.be.true\nexpect(response.body.data.original_url).to.equal(originalUrl)\nexpect(response.body.data.short_code).to.equal(shortCode)\n// Database should not be called when cache hit occurs\nexpect(mockDatabaseService.getClient().url.findUnique).to.not.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:340:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;58bce6f1-83cb-4376-8ee0-6c98bb6e23d4&quot;,&quot;parentUUID&quot;:&quot;76ba43dd-2a79-4e2c-9bcd-3ea8ef919619&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for non-existent short code&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/url/:shortCode should return 404 for non-existent short code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findUnique.resolves(null)\nconst response = await request(app)\n  .get(&#x27;/api/url/nonexistent&#x27;)\n  .expect(404)\nexpect(response.body).to.have.property(&#x27;status_code&#x27;, 404)\nexpect(response.body.error.code).to.equal(&#x27;NotFound&#x27;)\nexpect(response.body.error.message).to.include(&#x27;URL not found&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 404 \&quot;Not Found\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 404 \&quot;Not Found\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:355:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;fcfed1fb-bd20-456f-95b7-caba45b5e6a8&quot;,&quot;parentUUID&quot;:&quot;76ba43dd-2a79-4e2c-9bcd-3ea8ef919619&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid short code format&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/url/:shortCode should return 400 for invalid short code format&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .get(&#x27;/api/url/&#x27;)\n  .expect(404) // Express returns 404 for missing route parameter&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4102cde7-32b0-40bc-a4e9-9fd37103f432&quot;,&quot;parentUUID&quot;:&quot;76ba43dd-2a79-4e2c-9bcd-3ea8ef919619&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for database failure&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/url/:shortCode should return 500 for database failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findUnique.rejects(new Error(&#x27;Database connection failed&#x27;))\nconst response = await request(app)\n  .get(`/api/url/${shortCode}`)\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to retrieve URL&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:373:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;94050947-9165-4ad3-9c15-17e43c2b134b&quot;,&quot;parentUUID&quot;:&quot;76ba43dd-2a79-4e2c-9bcd-3ea8ef919619&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4102cde7-32b0-40bc-a4e9-9fd37103f432&quot;],&quot;failures&quot;:[&quot;7b7eb158-bc58-4530-98e8-6be13a02596b&quot;,&quot;58bce6f1-83cb-4376-8ee0-6c98bb6e23d4&quot;,&quot;fcfed1fb-bd20-456f-95b7-caba45b5e6a8&quot;,&quot;94050947-9165-4ad3-9c15-17e43c2b134b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ffa28672-e952-40f4-8e13-86b9550fbac4&quot;,&quot;title&quot;:&quot;DELETE /api/url/:shortCode&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully delete URL&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests DELETE /api/url/:shortCode should successfully delete URL&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.delete.resolves(mockDbResult)\nconst response = await request(app)\n  .delete(`/api/url/${shortCode}`)\n  .expect(200)\nexpect(response.body).to.deep.equal({\n  success: true,\n  data: {\n    original_url: originalUrl,\n    short_code: shortCode,\n    created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n    expires_at: &#x27;2024-07-15T10:30:00.000Z&#x27;,\n    click_count: 5\n  }\n})\nexpect(mockDatabaseService.getClient().url.delete).to.have.been.calledWith({\n  where: { shortCode: shortCode }\n})\nexpect(mockRedisService.removeCachedUrl).to.have.been.calledWith(shortCode)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:397:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;5f1de284-df4c-42a2-bbb3-e4e1ef14101d&quot;,&quot;parentUUID&quot;:&quot;ffa28672-e952-40f4-8e13-86b9550fbac4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for non-existent short code&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests DELETE /api/url/:shortCode should return 404 for non-existent short code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const notFoundError = new Error(&#x27;Record not found&#x27;)\nnotFoundError.code = &#x27;P2025&#x27;\nmockDatabaseService.getClient().url.delete.rejects(notFoundError)\nconst response = await request(app)\n  .delete(&#x27;/api/url/nonexistent&#x27;)\n  .expect(404)\nexpect(response.body.error.code).to.equal(&#x27;NotFound&#x27;)\nexpect(response.body.error.message).to.include(&#x27;URL not found&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 404 \&quot;Not Found\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 404 \&quot;Not Found\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:423:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;d4437f5f-0a8e-4d08-8be5-be429e77f496&quot;,&quot;parentUUID&quot;:&quot;ffa28672-e952-40f4-8e13-86b9550fbac4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for database failure&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests DELETE /api/url/:shortCode should return 500 for database failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.delete.rejects(new Error(&#x27;Database connection failed&#x27;))\nconst response = await request(app)\n  .delete(`/api/url/${shortCode}`)\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to delete URL&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 400 \&quot;Bad Request\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:434:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;69e4dffa-b9e4-4230-9bf1-4c9f6c6ca0e5&quot;,&quot;parentUUID&quot;:&quot;ffa28672-e952-40f4-8e13-86b9550fbac4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;5f1de284-df4c-42a2-bbb3-e4e1ef14101d&quot;,&quot;d4437f5f-0a8e-4d08-8be5-be429e77f496&quot;,&quot;69e4dffa-b9e4-4230-9bf1-4c9f6c6ca0e5&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c91a36ed-8d54-4d3d-89a7-450e86150e3b&quot;,&quot;title&quot;:&quot;GET /api/urls&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return all URLs&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/urls should return all URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findMany.resolves(mockDbResults)\nconst response = await request(app)\n  .get(&#x27;/api/urls&#x27;)\n  .expect(200)\nexpect(response.body).to.have.property(&#x27;success&#x27;, true)\nexpect(response.body.data).to.be.an(&#x27;array&#x27;).with.lengthOf(2)\nresponse.body.data.forEach((item, index) =&gt; {\n  expect(item).to.deep.equal({\n    original_url: mockDbResults[index].originalUrl,\n    short_code: mockDbResults[index].shortCode,\n    created_at: mockDbResults[index].createdAt.toISOString(),\n    expires_at: mockDbResults[index].expiresAt.toISOString(),\n    click_count: mockDbResults[index].clickCount\n  })\n})\nexpect(mockDatabaseService.getClient().url.findMany).to.have.been.calledWith({\n  orderBy: { createdAt: &#x27;desc&#x27; }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:465:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;89f3390f-32ce-4e5b-9fc8-b593cc32f236&quot;,&quot;parentUUID&quot;:&quot;c91a36ed-8d54-4d3d-89a7-450e86150e3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return empty array when no URLs exist&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/urls should return empty array when no URLs exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findMany.resolves([])\nconst response = await request(app)\n  .get(&#x27;/api/urls&#x27;)\n  .expect(200)\nexpect(response.body).to.deep.equal({\n  success: true,\n  data: []\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:490:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;652afdd5-a856-4444-8d61-2e1611682889&quot;,&quot;parentUUID&quot;:&quot;c91a36ed-8d54-4d3d-89a7-450e86150e3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for database failure&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests GET /api/urls should return 500 for database failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findMany.rejects(new Error(&#x27;Database connection failed&#x27;))\nconst response = await request(app)\n  .get(&#x27;/api/urls&#x27;)\n  .expect(500)\nexpect(response.body.error.message).to.include(&#x27;Failed to retrieve URLs&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Failed to retrieve URL list&#x27; to include &#x27;Failed to retrieve URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Failed to retrieve URL list&#x27; to include &#x27;Failed to retrieve URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:505:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;8fb3b1f9-2edc-4f84-b493-9c53c60f57db&quot;,&quot;parentUUID&quot;:&quot;c91a36ed-8d54-4d3d-89a7-450e86150e3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;89f3390f-32ce-4e5b-9fc8-b593cc32f236&quot;,&quot;652afdd5-a856-4444-8d61-2e1611682889&quot;,&quot;8fb3b1f9-2edc-4f84-b493-9c53c60f57db&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2af09042-82b8-45b8-9725-f86a5a801acd&quot;,&quot;title&quot;:&quot;Error Handling and Edge Cases&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle invalid JSON in request body&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Error Handling and Edge Cases should handle invalid JSON in request body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .set(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)\n  .send(&#x27;{\&quot;url\&quot;: invalid}&#x27;)\n  .expect(400)\nexpect(response.body.error.code).to.equal(&#x27;BadRequest&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;code&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;code&#x27;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:517:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;e047e1a9-e10b-465b-8303-9500030a7838&quot;,&quot;parentUUID&quot;:&quot;2af09042-82b8-45b8-9725-f86a5a801acd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle missing Content-Type header&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Error Handling and Edge Cases should handle missing Content-Type header&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send(&#x27;url=https://example.com&#x27;)\n  .expect(400)\n// Should handle non-JSON content gracefully\nexpect(response.body.error.code).to.equal(&#x27;BadRequest&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;INVALID_REQUEST_BODY&#x27; to equal &#x27;BadRequest&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;INVALID_REQUEST_BODY&#x27; to equal &#x27;BadRequest&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:527:43)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- INVALID_REQUEST_BODY\n+ BadRequest\n&quot;},&quot;uuid&quot;:&quot;1b58753f-2705-40f7-bdca-bae6fbfa59e9&quot;,&quot;parentUUID&quot;:&quot;2af09042-82b8-45b8-9725-f86a5a801acd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle very large request payloads&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Error Handling and Edge Cases should handle very large request payloads&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const largeUrl = &#x27;https://example.com/&#x27; + &#x27;a&#x27;.repeat(10000)\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: largeUrl })\n  .expect(400)\nexpect(response.body.error.message).to.include(&#x27;URL too long&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;URL exceeds maximum length of 2048 châ€¦&#x27; to include &#x27;URL too long&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;URL exceeds maximum length of 2048 châ€¦&#x27; to include &#x27;URL too long&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:538:46)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;2593749c-a0c4-4e55-bdc3-2a1a2abd2520&quot;,&quot;parentUUID&quot;:&quot;2af09042-82b8-45b8-9725-f86a5a801acd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return consistent error format across all endpoints&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Error Handling and Edge Cases should return consistent error format across all endpoints&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Test various error scenarios to ensure consistent format\nconst responses = await Promise.all([\n  request(app).post(&#x27;/api/shorten&#x27;).send({}),\n  request(app).get(&#x27;/api/url/nonexistent&#x27;),\n  request(app).delete(&#x27;/api/url/nonexistent&#x27;).send()\n])\nresponses.forEach(response =&gt; {\n  expect(response.body).to.have.property(&#x27;status_code&#x27;)\n  expect(response.body).to.have.property(&#x27;error&#x27;)\n  expect(response.body.error).to.have.property(&#x27;code&#x27;)\n  expect(response.body.error).to.have.property(&#x27;message&#x27;)\n  expect(response.body.error).to.have.property(&#x27;details&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a864b90a-6177-4eb1-bdec-92122162482a&quot;,&quot;parentUUID&quot;:&quot;2af09042-82b8-45b8-9725-f86a5a801acd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle concurrent requests properly&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Error Handling and Edge Cases should handle concurrent requests properly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrl = &#x27;https://example.com/concurrent&#x27;\nconst shortCode = &#x27;abc123&#x27;\nmockDatabaseService.getClient().url.create.resolves({\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n})\n// Make 5 concurrent requests\nconst promises = Array(5).fill().map(() =&gt; \n  request(app)\n    .post(&#x27;/api/shorten&#x27;)\n    .send({ url: validUrl })\n)\nconst responses = await Promise.all(promises)\nresponses.forEach(response =&gt; {\n  expect(response.status).to.equal(201)\n  expect(response.body.success).to.be.true\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 503 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 503 to equal 201\n    at file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:581:36\n    at Array.forEach (&lt;anonymous&gt;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:580:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 503\n+ 201\n&quot;},&quot;uuid&quot;:&quot;52a9a865-659e-41cb-8f7d-6f4292ecd08b&quot;,&quot;parentUUID&quot;:&quot;2af09042-82b8-45b8-9725-f86a5a801acd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a864b90a-6177-4eb1-bdec-92122162482a&quot;],&quot;failures&quot;:[&quot;e047e1a9-e10b-465b-8303-9500030a7838&quot;,&quot;1b58753f-2705-40f7-bdca-bae6fbfa59e9&quot;,&quot;2593749c-a0c4-4e55-bdc3-2a1a2abd2520&quot;,&quot;52a9a865-659e-41cb-8f7d-6f4292ecd08b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b4e51ea4-f69e-4664-96b5-c3c75eee135c&quot;,&quot;title&quot;:&quot;Response Headers and Formats&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js&quot;,&quot;file&quot;:&quot;/test/integration/api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should set correct Content-Type header&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Response Headers and Formats should set correct Content-Type header&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findMany.resolves([])\nconst response = await request(app)\n  .get(&#x27;/api/urls&#x27;)\n  .expect(200)\nexpect(response.headers[&#x27;content-type&#x27;]).to.include(&#x27;application/json&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:593:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;7109ce9a-1e07-42f1-8d53-acbfcc3260bc&quot;,&quot;parentUUID&quot;:&quot;b4e51ea4-f69e-4664-96b5-c3c75eee135c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should include proper HTTP status codes in response body&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Response Headers and Formats should include proper HTTP status codes in response body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrl = &#x27;https://example.com/test&#x27;\nmockDatabaseService.getClient().url.create.resolves({\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: &#x27;abc123&#x27;,\n  createdAt: new Date(),\n  expiresAt: new Date(),\n  clickCount: 0\n})\nconst response = await request(app)\n  .post(&#x27;/api/shorten&#x27;)\n  .send({ url: validUrl })\n  .expect(201)\n// Status code should match both HTTP status and response body\nexpect(response.status).to.equal(201)\nexpect(response.body).to.not.have.property(&#x27;status_code&#x27;) // Success responses don&#x27;t include status_code&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 201 \&quot;Created\&quot;, got 503 \&quot;Service Unavailable\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:612:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;17e2569c-e860-49f8-a02e-7a2756f16a8e&quot;,&quot;parentUUID&quot;:&quot;b4e51ea4-f69e-4664-96b5-c3c75eee135c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle HEAD requests appropriately&quot;,&quot;fullTitle&quot;:&quot;API Endpoints Integration Tests Response Headers and Formats should handle HEAD requests appropriately&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabaseService.getClient().url.findMany.resolves([])\nconst response = await request(app)\n  .head(&#x27;/api/urls&#x27;)\n  .expect(200)\nexpect(response.body).to.be.empty\nexpect(response.headers[&#x27;content-type&#x27;]).to.include(&#x27;application/json&#x27;)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 200 \&quot;OK\&quot;, got 500 \&quot;Internal Server Error\&quot;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/integration/api.test.js:624:10)\n    at process.processImmediate (node:internal/timers:476:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /Users/andrew/Dev/url-shortner-ai-demo/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:628:28)\n    at Server.emit (node:events:514:28)\n    at emitCloseNT (node:net:2148:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)&quot;},&quot;uuid&quot;:&quot;da59c503-acec-44f7-acf9-1a166236d204&quot;,&quot;parentUUID&quot;:&quot;b4e51ea4-f69e-4664-96b5-c3c75eee135c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;7109ce9a-1e07-42f1-8d53-acbfcc3260bc&quot;,&quot;17e2569c-e860-49f8-a02e-7a2756f16a8e&quot;,&quot;da59c503-acec-44f7-acf9-1a166236d204&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1171b481-eeb3-4ade-879e-d065c1c762bf&quot;,&quot;title&quot;:&quot;UrlService Unit Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;UrlService Unit Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests \&quot;before each\&quot; hook in \&quot;UrlService Unit Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox()\n\n// Mock Database (Prisma client structure)\nconst mockPrismaClient = {\n  url: {\n    create: sandbox.stub(),\n    findUnique: sandbox.stub(),\n    findMany: sandbox.stub(),\n    delete: sandbox.stub(),\n    update: sandbox.stub()\n  },\n  $transaction: sandbox.stub()\n}\nmockDatabase = {\n  getClient: sandbox.stub().returns(mockPrismaClient),\n  healthCheck: sandbox.stub().resolves(true),\n  isConnected: true\n}\n// Mock RedisService\nmockRedis = {\n  getShortCode: sandbox.stub(),\n  setShortCode: sandbox.stub(),\n  cacheUrl: sandbox.stub(),\n  getCachedUrl: sandbox.stub(),\n  removeCachedUrl: sandbox.stub(),\n  isHealthy: sandbox.stub().returns(true),\n  healthCheck: sandbox.stub().resolves(true),\n  isConnected: true\n}\n// Mock Logger\nmockLogger = {\n  debug: sandbox.stub(),\n  info: sandbox.stub(),\n  warn: sandbox.stub(),\n  error: sandbox.stub(),\n  fatal: sandbox.stub()\n}\nurlService = new UrlService(mockDatabase, mockRedis, mockLogger)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8245674f-f49e-4598-a8d5-f30f373f8f80&quot;,&quot;parentUUID&quot;:&quot;1171b481-eeb3-4ade-879e-d065c1c762bf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;UrlService Unit Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests \&quot;after each\&quot; hook in \&quot;UrlService Unit Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f22b82a3-287a-4c64-a954-6ea5ae7b351b&quot;,&quot;parentUUID&quot;:&quot;1171b481-eeb3-4ade-879e-d065c1c762bf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;title&quot;:&quot;createShortUrl()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;createShortUrl()\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() \&quot;before each\&quot; hook in \&quot;createShortUrl()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up default successful mocks\nmockRedis.getShortCode.resolves(shortCode)\nmockRedis.cacheUrl.resolves()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a94f4d5-b0ac-43b3-822a-ee346c098d2b&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully create a short URL with valid input&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should successfully create a short URL with valid input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}\nmockDatabase.getClient().url.create.resolves(mockDbResult)\nconst result = await urlService.createShortUrl(validUrl)\nexpect(result).to.be.an(&#x27;object&#x27;)\nexpect(result.originalUrl).to.equal(validUrl)\nexpect(result.shortCode).to.equal(shortCode)\nexpect(result.shortUrl).to.include(shortCode)\nexpect(result.createdAt).to.be.an.instanceof(Date)\nexpect(result.expiresAt).to.be.an.instanceof(Date)\n// Verify database create was called with correct data\nexpect(mockDatabase.getClient().url.create).to.have.been.calledOnce\nconst createCall = mockDatabase.getClient().url.create.getCall(0)\nexpect(createCall.args[0].data.originalUrl).to.equal(validUrl)\nexpect(createCall.args[0].data.shortCode).to.equal(shortCode)\n// Verify caching was attempted\nexpect(mockRedis.cacheUrl).to.have.been.called\n// Verify logging\nexpect(mockLogger.debug).to.have.been.called\nexpect(mockLogger.info).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledOnce&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledOnce\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:99:63)&quot;},&quot;uuid&quot;:&quot;a4e8dd47-535a-4409-91fd-5e1055c02321&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URLs with validation error&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should reject invalid URLs with validation error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidUrl = &#x27;not-a-url&#x27;\ntry {\n  await urlService.createShortUrl(invalidUrl)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Invalid URL format&#x27;)\n  expect(mockDatabase.getClient().url.create).to.not.have.been.called\n  expect(mockLogger.warn).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;URL is too short to be valid (minimumâ€¦&#x27; to include &#x27;Invalid URL format&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;URL is too short to be valid (minimumâ€¦&#x27; to include &#x27;Invalid URL format&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:119:34)&quot;},&quot;uuid&quot;:&quot;eb2a47fe-6afe-41ae-afe3-d8a71eae6157&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle URL that is too long&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should handle URL that is too long&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const longUrl = &#x27;https://example.com/&#x27; + &#x27;a&#x27;.repeat(3000)\ntry {\n  await urlService.createShortUrl(longUrl)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;exceeds maximum length&#x27;)\n  expect(mockDatabase.getClient().url.create).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:75:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:133:69)&quot;},&quot;uuid&quot;:&quot;1a54c59b-56bb-47cd-8863-3a72f470e900&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis failure gracefully and continue with database operation&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should handle Redis failure gracefully and continue with database operation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getShortCode.rejects(new Error(&#x27;Redis connection failed&#x27;))\n\nconst mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}\nmockDatabase.getClient().url.create.resolves(mockDbResult)\ntry {\n  const result = await urlService.createShortUrl(validUrl)\n  expect.fail(&#x27;Should have thrown error when Redis fails&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to generate short code&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Should have thrown error when Redis fâ€¦&#x27; to include &#x27;Failed to generate short code&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Should have thrown error when Redis fâ€¦&#x27; to include &#x27;Failed to generate short code&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:155:34)&quot;},&quot;uuid&quot;:&quot;d0060a41-7e89-4b19-875c-4d77b4b5694c&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database failure with appropriate error&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should handle database failure with appropriate error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dbError = new Error(&#x27;Database connection failed&#x27;)\nmockDatabase.healthCheck.rejects(dbError)\ntry {\n  await urlService.createShortUrl(validUrl)\n  expect.fail(&#x27;Should have thrown database error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Database service unavailable&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:75:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:169:46)&quot;},&quot;uuid&quot;:&quot;7e7d56ad-fd2e-4134-9dcc-c38a717f635c&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle unique constraint violation by retrying with new short code&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should handle unique constraint violation by retrying with new short code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const duplicateError = new Error(&#x27;Unique constraint failed&#x27;)\nduplicateError.code = &#x27;P2002&#x27; // Prisma unique constraint error code\n\nconst newShortCode = &#x27;def456&#x27;\nconst mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: newShortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}\n// First call fails with unique constraint, second succeeds\nmockDatabase.getClient().url.create\n  .onFirstCall().rejects(duplicateError)\n  .onSecondCall().resolves(mockDbResult)\n\n// Return different short codes on subsequent calls\nmockRedis.getShortCode\n  .onFirstCall().resolves(shortCode)\n  .onSecondCall().resolves(newShortCode)\nconst result = await urlService.createShortUrl(validUrl)\nexpect(result.shortCode).to.equal(newShortCode)\nexpect(mockDatabase.getClient().url.create).to.have.been.calledTwice\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Duplicate short code.*retrying/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Failed to create shortened URL&quot;,&quot;estack&quot;:&quot;Error: Failed to create shortened URL\n    at UrlService.createShortUrl (file:///Users/andrew/Dev/url-shortner-ai-demo/services/UrlService.js:148:13)\n    at async Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:197:22)&quot;},&quot;uuid&quot;:&quot;439fb145-367b-4f9b-bfcf-4833841e2e01&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail after maximum retry attempts for unique constraint violations&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should fail after maximum retry attempts for unique constraint violations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const duplicateError = new Error(&#x27;Unique constraint failed&#x27;)\nduplicateError.code = &#x27;P2002&#x27;\n\nmockDatabase.getClient().url.create.rejects(duplicateError)\nmockRedis.getShortCode.resolves(shortCode)\ntry {\n  await urlService.createShortUrl(validUrl)\n  expect.fail(&#x27;Should have thrown error after max retries&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to create short URL after retries&#x27;)\n  expect(mockDatabase.getClient().url.create.callCount).to.equal(3) // Default max retries\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Failed to create shortened URL&#x27; to include &#x27;Failed to create short URL after retrâ€¦&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Failed to create shortened URL&#x27; to include &#x27;Failed to create short URL after retrâ€¦&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:218:34)&quot;},&quot;uuid&quot;:&quot;ead7c54b-0986-4ed8-8f84-3d3170106d17&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle caching failure gracefully without affecting URL creation&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should handle caching failure gracefully without affecting URL creation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}\nmockDatabase.getClient().url.create.resolves(mockDbResult)\nmockRedis.cacheUrl.rejects(new Error(&#x27;Cache write failed&#x27;))\nconst result = await urlService.createShortUrl(validUrl)\nexpect(result).to.be.an(&#x27;object&#x27;)\nexpect(result.originalUrl).to.equal(validUrl)\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Failed to cache.*continuing/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledWith&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledWith\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:240:43)&quot;},&quot;uuid&quot;:&quot;68799ced-134a-4235-bf44-ec98ab3075c7&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should use default base URL when not provided&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should use default base URL when not provided&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}\nmockDatabase.getClient().url.create.resolves(mockDbResult)\nconst result = await urlService.createShortUrl(validUrl)\nexpect(result.shortUrl).to.include(shortCode)\nexpect(result.shortUrl).to.not.be.null&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0740016a-094c-450c-b6d0-615de011d7f2&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should calculate correct expiration date&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createShortUrl() should calculate correct expiration date&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const now = new Date(&#x27;2024-01-15T10:30:00Z&#x27;)\nconst expectedExpiration = new Date(&#x27;2024-07-15T10:30:00Z&#x27;) // 6 months later\n\nconst mockDbResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: validUrl,\n  shortCode: shortCode,\n  createdAt: now,\n  expiresAt: expectedExpiration,\n  clickCount: 0\n}\nmockDatabase.getClient().url.create.resolves(mockDbResult)\nconst result = await urlService.createShortUrl(validUrl)\nexpect(result.expiresAt).to.equal(expectedExpiration.toISOString())&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 2024-07-15T10:30:00.000Z to equal &#x27;2024-07-15T10:30:00.000Z&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected 2024-07-15T10:30:00.000Z to equal &#x27;2024-07-15T10:30:00.000Z&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:281:35)&quot;},&quot;uuid&quot;:&quot;3435d7c8-9512-436a-9dfa-226fc4f127e8&quot;,&quot;parentUUID&quot;:&quot;20be396e-7d04-4faa-8b92-593154393c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0740016a-094c-450c-b6d0-615de011d7f2&quot;],&quot;failures&quot;:[&quot;a4e8dd47-535a-4409-91fd-5e1055c02321&quot;,&quot;eb2a47fe-6afe-41ae-afe3-d8a71eae6157&quot;,&quot;1a54c59b-56bb-47cd-8863-3a72f470e900&quot;,&quot;d0060a41-7e89-4b19-875c-4d77b4b5694c&quot;,&quot;7e7d56ad-fd2e-4134-9dcc-c38a717f635c&quot;,&quot;439fb145-367b-4f9b-bfcf-4833841e2e01&quot;,&quot;ead7c54b-0986-4ed8-8f84-3d3170106d17&quot;,&quot;68799ced-134a-4235-bf44-ec98ab3075c7&quot;,&quot;3435d7c8-9512-436a-9dfa-226fc4f127e8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;title&quot;:&quot;createBulkShortUrls()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;createBulkShortUrls()\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() \&quot;before each\&quot; hook in \&quot;createBulkShortUrls()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up default successful mocks\nmockRedis.getShortCode\n  .onFirstCall().resolves(shortCodes[0])\n  .onSecondCall().resolves(shortCodes[1])\n  .onThirdCall().resolves(shortCodes[2])\nmockRedis.cacheUrl.resolves()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c026d94-e7b2-4ac8-85d5-b3bfa87223dc&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully create multiple short URLs&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should successfully create multiple short URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mockDbResults = validUrls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: shortCodes[index],\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\n// Mock transaction that returns all created URLs\nmockDatabase.getClient().$transaction.resolves(mockDbResults)\nconst result = await urlService.createBulkShortUrls(validUrls, baseUrl)\nexpect(result).to.be.an(&#x27;array&#x27;)\nexpect(result).to.have.lengthOf(3)\nresult.forEach((item, index) =&gt; {\n  expect(item).to.deep.equal({\n    original_url: validUrls[index],\n    short_url: `${baseUrl}/${shortCodes[index]}`,\n    short_code: shortCodes[index]\n  })\n})\n// Verify transaction was called\nexpect(mockDatabase.getClient().$transaction).to.have.been.calledOnce\n// Verify caching attempts for all URLs\nexpect(mockRedis.cacheUrl).to.have.been.calledThrice\n// Verify logging\nexpect(mockLogger.info).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Successfully created.*bulk URLs/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array&quot;,&quot;estack&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:318:28)&quot;},&quot;uuid&quot;:&quot;1a4db19c-38f2-4418-b9bb-6f34dae0a384&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject empty URL array&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should reject empty URL array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n  await urlService.createBulkShortUrls([], baseUrl)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;URLs array cannot be empty&#x27;)\n  expect(mockDatabase.getClient().$transaction).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:75:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:348:71)&quot;},&quot;uuid&quot;:&quot;d1a05a78-4741-42c3-8d5c-2b6b8998ba66&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject URL array exceeding maximum limit&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should reject URL array exceeding maximum limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tooManyUrls = new Array(1001).fill(&#x27;https://example.com&#x27;)\ntry {\n  await urlService.createBulkShortUrls(tooManyUrls, baseUrl)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Too many URLs&#x27;)\n  expect(mockDatabase.getClient().$transaction).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Bulk operations are limited to 1000 Uâ€¦&#x27; to include &#x27;Too many URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Bulk operations are limited to 1000 Uâ€¦&#x27; to include &#x27;Too many URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:359:34)&quot;},&quot;uuid&quot;:&quot;7dffbe35-fd2f-4048-a674-5667c464f3c0&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail entire operation if any URL is invalid&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should fail entire operation if any URL is invalid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mixedUrls = [\n  &#x27;https://example.com/valid&#x27;,\n  &#x27;invalid-url&#x27;,\n  &#x27;https://example.com/also-valid&#x27;\n]\ntry {\n  await urlService.createBulkShortUrls(mixedUrls, baseUrl)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Invalid URL&#x27;)\n  expect(mockDatabase.getClient().$transaction).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;Invalid URL&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:375:34)&quot;},&quot;uuid&quot;:&quot;7cc49a4c-ea37-4a0f-895d-5bac7326b10d&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis failure gracefully and continue with database operation&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should handle Redis failure gracefully and continue with database operation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getShortCode.rejects(new Error(&#x27;Redis connection failed&#x27;))\n\nconst mockDbResults = validUrls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: `fallback-${index}`,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabase.getClient().$transaction.resolves(mockDbResults)\nconst result = await urlService.createBulkShortUrls(validUrls, baseUrl)\nexpect(result).to.be.an(&#x27;array&#x27;)\nexpect(result).to.have.lengthOf(3)\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Redis.*failed.*fallback/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array&quot;,&quot;estack&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:396:28)&quot;},&quot;uuid&quot;:&quot;bcae93c0-fcb3-4b60-a634-895088775120&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database transaction failure&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should handle database transaction failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dbError = new Error(&#x27;Transaction failed&#x27;)\nmockDatabase.getClient().$transaction.rejects(dbError)\ntry {\n  await urlService.createBulkShortUrls(validUrls, baseUrl)\n  expect.fail(&#x27;Should have thrown database error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to create bulk short URLs&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Failed to create bulk URLs: Transactiâ€¦&#x27; to include &#x27;Failed to create bulk short URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Failed to create bulk URLs: Transactiâ€¦&#x27; to include &#x27;Failed to create bulk short URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:412:34)&quot;},&quot;uuid&quot;:&quot;f3f45f82-33e0-417b-8553-c452d92a6909&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle partial Redis caching failures without affecting URL creation&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should handle partial Redis caching failures without affecting URL creation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mockDbResults = validUrls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: shortCodes[index],\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabase.getClient().$transaction.resolves(mockDbResults)\n\n// Make some cache operations fail\nmockRedis.cacheUrl\n  .onFirstCall().resolves()\n  .onSecondCall().rejects(new Error(&#x27;Cache write failed&#x27;))\n  .onThirdCall().resolves()\nconst result = await urlService.createBulkShortUrls(validUrls, baseUrl)\nexpect(result).to.be.an(&#x27;array&#x27;)\nexpect(result).to.have.lengthOf(3)\nexpect(mockLogger.warn).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array&quot;,&quot;estack&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:437:28)&quot;},&quot;uuid&quot;:&quot;2c003d49-9b17-4088-a1e3-377d713dcbbd&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate individual URLs in the array&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should validate individual URLs in the array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urlsWithInvalid = [\n  &#x27;https://example.com/valid&#x27;,\n  &#x27;ftp://invalid-protocol.com&#x27;,\n  &#x27;https://example.com/also-valid&#x27;\n]\ntry {\n  await urlService.createBulkShortUrls(urlsWithInvalid, baseUrl)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;ftp://invalid-protocol.com&#x27;)\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;ftp://invalid-protocol.com&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;1 URLs failed validation&#x27; to include &#x27;ftp://invalid-protocol.com&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:453:34)&quot;},&quot;uuid&quot;:&quot;c296a1b6-1466-4eed-9e69-afcf560a0f4a&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle duplicate URLs in input array&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should handle duplicate URLs in input array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const duplicateUrls = [\n  &#x27;https://example.com/same&#x27;,\n  &#x27;https://example.com/different&#x27;,\n  &#x27;https://example.com/same&#x27;\n]\nconst mockDbResults = [\n  {\n    id: &#x27;test-id-0&#x27;,\n    originalUrl: duplicateUrls[0],\n    shortCode: shortCodes[0],\n    createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n    expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n    clickCount: 0\n  },\n  {\n    id: &#x27;test-id-1&#x27;,\n    originalUrl: duplicateUrls[1],\n    shortCode: shortCodes[1],\n    createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n    expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n    clickCount: 0\n  },\n  {\n    id: &#x27;test-id-2&#x27;,\n    originalUrl: duplicateUrls[2],\n    shortCode: shortCodes[2],\n    createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n    expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n    clickCount: 0\n  }\n]\nmockDatabase.getClient().$transaction.resolves(mockDbResults)\nconst result = await urlService.createBulkShortUrls(duplicateUrls, baseUrl)\nexpect(result).to.be.an(&#x27;array&#x27;)\nexpect(result).to.have.lengthOf(3)\n// Should create separate short URLs even for duplicate original URLs\nexpect(result[0].short_code).to.not.equal(result[2].short_code)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array&quot;,&quot;estack&quot;:&quot;AssertionError: expected { successCount: 3, â€¦(3) } to be an array\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:495:28)&quot;},&quot;uuid&quot;:&quot;efadd386-05af-4f8e-a83b-0a4b98e6dc59&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should use transaction for atomic operation&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests createBulkShortUrls() should use transaction for atomic operation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mockDbResults = validUrls.map((url, index) =&gt; ({\n  id: `test-id-${index}`,\n  originalUrl: url,\n  shortCode: shortCodes[index],\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 0\n}))\nmockDatabase.getClient().$transaction.resolves(mockDbResults)\nawait urlService.createBulkShortUrls(validUrls, baseUrl)\n// Verify transaction was called with array of operations\nexpect(mockDatabase.getClient().$transaction).to.have.been.calledOnce\nconst transactionCall = mockDatabase.getClient().$transaction.getCall(0)\nexpect(transactionCall.args[0]).to.be.an(&#x27;array&#x27;)\nexpect(transactionCall.args[0]).to.have.lengthOf(3)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledOnce&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledOnce\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:516:65)&quot;},&quot;uuid&quot;:&quot;bae05f70-5f24-4699-99dc-9918b5afb243&quot;,&quot;parentUUID&quot;:&quot;d4cfd7fb-00f0-4d66-b431-1658c0fbe00c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1a4db19c-38f2-4418-b9bb-6f34dae0a384&quot;,&quot;d1a05a78-4741-42c3-8d5c-2b6b8998ba66&quot;,&quot;7dffbe35-fd2f-4048-a674-5667c464f3c0&quot;,&quot;7cc49a4c-ea37-4a0f-895d-5bac7326b10d&quot;,&quot;bcae93c0-fcb3-4b60-a634-895088775120&quot;,&quot;f3f45f82-33e0-417b-8553-c452d92a6909&quot;,&quot;2c003d49-9b17-4088-a1e3-377d713dcbbd&quot;,&quot;c296a1b6-1466-4eed-9e69-afcf560a0f4a&quot;,&quot;efadd386-05af-4f8e-a83b-0a4b98e6dc59&quot;,&quot;bae05f70-5f24-4699-99dc-9918b5afb243&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;title&quot;:&quot;getUrlByShortCode()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return URL details from cache when available (cache hit)&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should return URL details from cache when available (cache hit)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.resolves(originalUrl)\nconst result = await urlService.getUrlByShortCode(shortCode)\nexpect(result).to.deep.equal({\n  original_url: originalUrl,\n  short_code: shortCode,\n  created_at: undefined, // Cache only stores URL, not full metadata\n  expires_at: undefined,\n  click_count: undefined\n})\n// Verify cache was checked first\nexpect(mockRedis.getCachedUrl).to.have.been.calledWith(shortCode)\n// Database should not be called when cache hit occurs\nexpect(mockDatabase.getClient().url.findUnique).to.not.have.been.called\nexpect(mockLogger.debug).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Found.*in cache/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:541:30)&quot;},&quot;uuid&quot;:&quot;4dcd5302-7b77-41b5-81b8-a53571e3d67a&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return full URL details from database when cache miss occurs&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should return full URL details from database when cache miss occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.resolves(null) // Cache miss\nmockDatabase.getClient().url.findUnique.resolves(mockDbResult)\nmockRedis.cacheUrl.resolves() // Successful re-caching\nconst result = await urlService.getUrlByShortCode(shortCode)\nexpect(result).to.deep.equal({\n  original_url: originalUrl,\n  short_code: shortCode,\n  created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n  expires_at: &#x27;2024-07-15T10:30:00.000Z&#x27;,\n  click_count: 42\n})\n// Verify cache was checked first, then database\nexpect(mockRedis.getCachedUrl).to.have.been.calledWith(shortCode)\nexpect(mockDatabase.getClient().url.findUnique).to.have.been.calledWith({\n  where: { shortCode: shortCode }\n})\n// Verify URL was re-cached after database retrieval\nexpect(mockRedis.cacheUrl).to.have.been.calledWith(shortCode, originalUrl)\nexpect(mockLogger.debug).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Cache miss.*retrieving from database/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:567:30)&quot;},&quot;uuid&quot;:&quot;c0f80165-ff0d-4d31-8867-58626caabc96&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return null when short code is not found&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should return null when short code is not found&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.resolves(null)\nmockDatabase.getClient().url.findUnique.resolves(null)\nconst result = await urlService.getUrlByShortCode(shortCode)\nexpect(result).to.be.null\nexpect(mockLogger.debug).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Short code.*not found/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledWith&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledWith\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:598:44)&quot;},&quot;uuid&quot;:&quot;e505f0aa-e2ca-440a-9671-49fa4242decc&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis cache failure gracefully and continue with database lookup&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should handle Redis cache failure gracefully and continue with database lookup&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.rejects(new Error(&#x27;Redis connection failed&#x27;))\nmockDatabase.getClient().url.findUnique.resolves(mockDbResult)\nconst result = await urlService.getUrlByShortCode(shortCode)\nexpect(result).to.deep.equal({\n  original_url: originalUrl,\n  short_code: shortCode,\n  created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n  expires_at: &#x27;2024-07-15T10:30:00.000Z&#x27;,\n  click_count: 42\n})\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Cache lookup failed.*falling back to database/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:610:30)&quot;},&quot;uuid&quot;:&quot;15861e09-6122-4075-b930-f293d2fa851f&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database failure with appropriate error&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should handle database failure with appropriate error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.resolves(null)\nconst dbError = new Error(&#x27;Database connection failed&#x27;)\nmockDatabase.getClient().url.findUnique.rejects(dbError)\ntry {\n  await urlService.getUrlByShortCode(shortCode)\n  expect.fail(&#x27;Should have thrown database error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to retrieve URL&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Database service unavailable&#x27; to include &#x27;Failed to retrieve URL&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Database service unavailable&#x27; to include &#x27;Failed to retrieve URL&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:633:34)&quot;},&quot;uuid&quot;:&quot;1aa1b837-3930-4ed0-85e3-44b63e187b17&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle cache write failure gracefully after database retrieval&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should handle cache write failure gracefully after database retrieval&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.resolves(null)\nmockDatabase.getClient().url.findUnique.resolves(mockDbResult)\nmockRedis.cacheUrl.rejects(new Error(&#x27;Cache write failed&#x27;))\nconst result = await urlService.getUrlByShortCode(shortCode)\nexpect(result).to.be.an(&#x27;object&#x27;)\nexpect(result.original_url).to.equal(originalUrl)\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Failed to cache.*after database retrieval/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null to be an object&quot;,&quot;estack&quot;:&quot;AssertionError: expected null to be an object\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:645:28)&quot;},&quot;uuid&quot;:&quot;c2ce907a-637b-4019-af5f-cffa37c2b647&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate short code format&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should validate short code format&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidShortCode = &#x27;&#x27;\ntry {\n  await urlService.getUrlByShortCode(invalidShortCode)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Short code is required&#x27;)\n  expect(mockRedis.getCachedUrl).to.not.have.been.called\n  expect(mockDatabase.getClient().url.findUnique).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:75:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:662:56)&quot;},&quot;uuid&quot;:&quot;b641cf0c-0a1d-4d29-8581-5b63686c0375&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle expired URLs appropriately&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should handle expired URLs appropriately&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expiredDbResult = {\n  ...mockDbResult,\n  expiresAt: new Date(&#x27;2023-01-15T10:30:00Z&#x27;) // Expired date\n}\nmockRedis.getCachedUrl.resolves(null)\nmockDatabase.getClient().url.findUnique.resolves(expiredDbResult)\nconst result = await urlService.getUrlByShortCode(shortCode)\nexpect(result).to.deep.equal({\n  original_url: originalUrl,\n  short_code: shortCode,\n  created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n  expires_at: &#x27;2023-01-15T10:30:00.000Z&#x27;,\n  click_count: 42\n})\n// Should still return the URL data even if expired\n// Expiration handling might be done at the application layer\nexpect(mockLogger.debug).to.have.been.called&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected null to deeply equal { â€¦(5) }\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:678:30)&quot;},&quot;uuid&quot;:&quot;3d4a6ec8-fa0a-43e4-81be-914e45a250c9&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should preserve exact database field mapping&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getUrlByShortCode() should preserve exact database field mapping&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.getCachedUrl.resolves(null)\nmockDatabase.getClient().url.findUnique.resolves(mockDbResult)\nconst result = await urlService.getUrlByShortCode(shortCode)\n// Verify field mapping from database to API response format\nexpect(result.original_url).to.equal(mockDbResult.originalUrl)\nexpect(result.short_code).to.equal(mockDbResult.shortCode)\nexpect(result.created_at).to.equal(mockDbResult.createdAt.toISOString())\nexpect(result.expires_at).to.equal(mockDbResult.expiresAt.toISOString())\nexpect(result.click_count).to.equal(mockDbResult.clickCount)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;original_url&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;original_url&#x27;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:698:21)&quot;},&quot;uuid&quot;:&quot;2a565e75-6c1f-4257-acb9-5b5ab6809977&quot;,&quot;parentUUID&quot;:&quot;aa7ab5ce-9c65-40ff-a02d-da5a2642fc88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;4dcd5302-7b77-41b5-81b8-a53571e3d67a&quot;,&quot;c0f80165-ff0d-4d31-8867-58626caabc96&quot;,&quot;e505f0aa-e2ca-440a-9671-49fa4242decc&quot;,&quot;15861e09-6122-4075-b930-f293d2fa851f&quot;,&quot;1aa1b837-3930-4ed0-85e3-44b63e187b17&quot;,&quot;c2ce907a-637b-4019-af5f-cffa37c2b647&quot;,&quot;b641cf0c-0a1d-4d29-8581-5b63686c0375&quot;,&quot;3d4a6ec8-fa0a-43e4-81be-914e45a250c9&quot;,&quot;2a565e75-6c1f-4257-acb9-5b5ab6809977&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;eb967f51-f262-4d75-9f96-e893edbc0bf7&quot;,&quot;title&quot;:&quot;deleteUrl()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully delete URL and invalidate cache&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests deleteUrl() should successfully delete URL and invalidate cache&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient().url.delete.resolves(mockDbResult)\nmockRedis.removeCachedUrl.resolves()\nconst result = await urlService.deleteUrl(shortCode)\nexpect(result).to.deep.equal({\n  original_url: originalUrl,\n  short_code: shortCode,\n  created_at: &#x27;2024-01-15T10:30:00.000Z&#x27;,\n  expires_at: &#x27;2024-07-15T10:30:00.000Z&#x27;,\n  click_count: 5\n})\nexpect(mockDatabase.getClient().url.delete).to.have.been.calledWith({\n  where: { shortCode: shortCode }\n})\nexpect(mockRedis.removeCachedUrl).to.have.been.calledWith(shortCode)\nexpect(mockLogger.info).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Successfully deleted URL/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to deeply equal { â€¦(5) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to deeply equal { â€¦(5) }\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:725:30)&quot;},&quot;uuid&quot;:&quot;2db43886-aa69-4e52-92d7-fd719a7afc4d&quot;,&quot;parentUUID&quot;:&quot;eb967f51-f262-4d75-9f96-e893edbc0bf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle deletion of non-existent URL&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests deleteUrl() should handle deletion of non-existent URL&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const notFoundError = new Error(&#x27;Record not found&#x27;)\nnotFoundError.code = &#x27;P2025&#x27; // Prisma record not found error code\nmockDatabase.getClient().url.delete.rejects(notFoundError)\ntry {\n  await urlService.deleteUrl(shortCode)\n  expect.fail(&#x27;Should have thrown not found error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;URL not found&#x27;)\n  expect(mockLogger.debug).to.have.been.calledWith(\n    sinon.match.string,\n    sinon.match(/URL.*not found for deletion/i)\n  )\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Should have thrown not found error&#x27; to include &#x27;URL not found&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Should have thrown not found error&#x27; to include &#x27;URL not found&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:754:34)&quot;},&quot;uuid&quot;:&quot;c4a9fb1d-1a49-40a7-b82e-f4ba03001a3c&quot;,&quot;parentUUID&quot;:&quot;eb967f51-f262-4d75-9f96-e893edbc0bf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database failure during deletion&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests deleteUrl() should handle database failure during deletion&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dbError = new Error(&#x27;Database connection failed&#x27;)\nmockDatabase.getClient().url.delete.rejects(dbError)\ntry {\n  await urlService.deleteUrl(shortCode)\n  expect.fail(&#x27;Should have thrown database error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to delete URL&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Should have thrown database error&#x27; to include &#x27;Failed to delete URL&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Should have thrown database error&#x27; to include &#x27;Failed to delete URL&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:770:34)&quot;},&quot;uuid&quot;:&quot;1c00abf1-e696-47e8-801c-a5ce60aa8dcd&quot;,&quot;parentUUID&quot;:&quot;eb967f51-f262-4d75-9f96-e893edbc0bf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle cache invalidation failure gracefully&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests deleteUrl() should handle cache invalidation failure gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient().url.delete.resolves(mockDbResult)\nmockRedis.removeCachedUrl.rejects(new Error(&#x27;Cache removal failed&#x27;))\nconst result = await urlService.deleteUrl(shortCode)\nexpect(result).to.be.an(&#x27;object&#x27;)\nexpect(result.short_code).to.equal(shortCode)\nexpect(mockLogger.warn).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Failed to remove.*from cache/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be an object&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be an object\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:781:28)&quot;},&quot;uuid&quot;:&quot;db8024e3-8c36-471c-971b-4925f98df2c1&quot;,&quot;parentUUID&quot;:&quot;eb967f51-f262-4d75-9f96-e893edbc0bf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate short code before deletion&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests deleteUrl() should validate short code before deletion&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n  await urlService.deleteUrl(&#x27;&#x27;)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Short code is required&#x27;)\n  expect(mockDatabase.getClient().url.delete).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:75:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:796:69)&quot;},&quot;uuid&quot;:&quot;153a722d-8fe8-4cfd-aedd-c78f04b841ca&quot;,&quot;parentUUID&quot;:&quot;eb967f51-f262-4d75-9f96-e893edbc0bf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;2db43886-aa69-4e52-92d7-fd719a7afc4d&quot;,&quot;c4a9fb1d-1a49-40a7-b82e-f4ba03001a3c&quot;,&quot;1c00abf1-e696-47e8-801c-a5ce60aa8dcd&quot;,&quot;db8024e3-8c36-471c-971b-4925f98df2c1&quot;,&quot;153a722d-8fe8-4cfd-aedd-c78f04b841ca&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9b07d8c5-862a-4fca-bddd-402f2c3eafdb&quot;,&quot;title&quot;:&quot;getAllUrls()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully retrieve all URLs with metadata&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getAllUrls() should successfully retrieve all URLs with metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient().url.findMany.resolves(mockDbResults)\nconst result = await urlService.getAllUrls()\nexpect(result).to.be.an(&#x27;array&#x27;)\nexpect(result).to.have.lengthOf(2)\nresult.forEach((item, index) =&gt; {\n  expect(item).to.deep.equal({\n    original_url: mockDbResults[index].originalUrl,\n    short_code: mockDbResults[index].shortCode,\n    created_at: mockDbResults[index].createdAt.toISOString(),\n    expires_at: mockDbResults[index].expiresAt.toISOString(),\n    click_count: mockDbResults[index].clickCount\n  })\n})\nexpect(mockDatabase.getClient().url.findMany).to.have.been.calledOnce\nexpect(mockLogger.debug).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Retrieved.*URLs from database/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected [] to have a length of 2 but got +0&quot;,&quot;estack&quot;:&quot;AssertionError: expected [] to have a length of 2 but got +0\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:827:30)&quot;,&quot;diff&quot;:&quot;- 0\n+ 2\n&quot;},&quot;uuid&quot;:&quot;35ed078f-cc1e-4650-97ac-7a970447f9f4&quot;,&quot;parentUUID&quot;:&quot;9b07d8c5-862a-4fca-bddd-402f2c3eafdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle empty result set&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getAllUrls() should handle empty result set&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient().url.findMany.resolves([])\nconst result = await urlService.getAllUrls()\nexpect(result).to.be.an(&#x27;array&#x27;)\nexpect(result).to.have.lengthOf(0)\nexpect(mockLogger.debug).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Retrieved.*0.*URLs/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledWith&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledWith\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:855:44)&quot;},&quot;uuid&quot;:&quot;53c55c58-98a1-4e93-9b51-d49a56613e60&quot;,&quot;parentUUID&quot;:&quot;9b07d8c5-862a-4fca-bddd-402f2c3eafdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database failure&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getAllUrls() should handle database failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dbError = new Error(&#x27;Database connection failed&#x27;)\nmockDatabase.getClient().url.findMany.rejects(dbError)\ntry {\n  await urlService.getAllUrls()\n  expect.fail(&#x27;Should have thrown database error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to retrieve URLs&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Database service unavailable&#x27; to include &#x27;Failed to retrieve URLs&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Database service unavailable&#x27; to include &#x27;Failed to retrieve URLs&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:869:34)&quot;},&quot;uuid&quot;:&quot;054e4119-a47e-4e50-9b58-845243d7ad83&quot;,&quot;parentUUID&quot;:&quot;9b07d8c5-862a-4fca-bddd-402f2c3eafdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should use proper sorting (newest first)&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests getAllUrls() should use proper sorting (newest first)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient().url.findMany.resolves(mockDbResults)\nawait urlService.getAllUrls()\nexpect(mockDatabase.getClient().url.findMany).to.have.been.calledWith({\n  orderBy: { createdAt: &#x27;desc&#x27; }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledWith&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledWith\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:879:65)&quot;},&quot;uuid&quot;:&quot;7a465812-8bbd-4ecd-a05f-aab935d4ea69&quot;,&quot;parentUUID&quot;:&quot;9b07d8c5-862a-4fca-bddd-402f2c3eafdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;35ed078f-cc1e-4650-97ac-7a970447f9f4&quot;,&quot;53c55c58-98a1-4e93-9b51-d49a56613e60&quot;,&quot;054e4119-a47e-4e50-9b58-845243d7ad83&quot;,&quot;7a465812-8bbd-4ecd-a05f-aab935d4ea69&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b9652e77-c325-488b-89d5-1a0b0cc2a2cf&quot;,&quot;title&quot;:&quot;incrementClickCount()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js&quot;,&quot;file&quot;:&quot;/test/services/UrlService.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully increment click count&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests incrementClickCount() should successfully increment click count&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const updatedResult = {\n  id: &#x27;test-id&#x27;,\n  originalUrl: &#x27;https://example.com/test&#x27;,\n  shortCode: shortCode,\n  createdAt: new Date(&#x27;2024-01-15T10:30:00Z&#x27;),\n  expiresAt: new Date(&#x27;2024-07-15T10:30:00Z&#x27;),\n  clickCount: 43 // Incremented from 42\n}\nmockDatabase.getClient().url.update.resolves(updatedResult)\nconst result = await urlService.incrementClickCount(shortCode)\nexpect(result).to.equal(43)\nexpect(mockDatabase.getClient().url.update).to.have.been.calledWith({\n  where: { shortCode: shortCode },\n  data: { clickCount: { increment: 1 } }\n})\nexpect(mockLogger.debug).to.have.been.calledWith(\n  sinon.match.string,\n  sinon.match(/Incremented click count.*43/i)\n)&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: calledWith&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: calledWith\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:78:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:904:63)&quot;},&quot;uuid&quot;:&quot;c62d3e48-5d92-4d65-9ed9-1e9862db8fcf&quot;,&quot;parentUUID&quot;:&quot;b9652e77-c325-488b-89d5-1a0b0cc2a2cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-existent URL during click increment&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests incrementClickCount() should handle non-existent URL during click increment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const notFoundError = new Error(&#x27;Record not found&#x27;)\nnotFoundError.code = &#x27;P2025&#x27;\nmockDatabase.getClient().url.update.rejects(notFoundError)\ntry {\n  await urlService.incrementClickCount(shortCode)\n  expect.fail(&#x27;Should have thrown not found error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;URL not found&#x27;)\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Should have thrown not found error&#x27; to include &#x27;URL not found&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Should have thrown not found error&#x27; to include &#x27;URL not found&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:924:34)&quot;},&quot;uuid&quot;:&quot;d21dfdf1-409e-411a-ab52-8a15320155b1&quot;,&quot;parentUUID&quot;:&quot;b9652e77-c325-488b-89d5-1a0b0cc2a2cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database failure during click increment&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests incrementClickCount() should handle database failure during click increment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dbError = new Error(&#x27;Database connection failed&#x27;)\nmockDatabase.getClient().url.update.rejects(dbError)\ntry {\n  await urlService.incrementClickCount(shortCode)\n  expect.fail(&#x27;Should have thrown database error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to increment click count&#x27;)\n  expect(mockLogger.error).to.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Database service unavailable&#x27; to include &#x27;Failed to increment click count&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Database service unavailable&#x27; to include &#x27;Failed to increment click count&#x27;\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:936:34)&quot;},&quot;uuid&quot;:&quot;ac1d05cb-5f3d-48a9-8101-d4ccbd2dfd05&quot;,&quot;parentUUID&quot;:&quot;b9652e77-c325-488b-89d5-1a0b0cc2a2cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate short code&quot;,&quot;fullTitle&quot;:&quot;UrlService Unit Tests incrementClickCount() should validate short code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n  await urlService.incrementClickCount(&#x27;&#x27;)\n  expect.fail(&#x27;Should have thrown validation error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Short code is required&#x27;)\n  expect(mockDatabase.getClient().url.update).to.not.have.been.called\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?&quot;,&quot;estack&quot;:&quot;Error: Invalid Chai property: called. Did you mean \&quot;all\&quot;?\n    at Object.proxyGetter [as get] (node_modules/chai/lib/chai/utils/proxify.js:75:17)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/services/UrlService.test.js:947:69)&quot;},&quot;uuid&quot;:&quot;6ff02532-b393-4a0f-bad6-d5b989c92624&quot;,&quot;parentUUID&quot;:&quot;b9652e77-c325-488b-89d5-1a0b0cc2a2cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;c62d3e48-5d92-4d65-9ed9-1e9862db8fcf&quot;,&quot;d21dfdf1-409e-411a-ab52-8a15320155b1&quot;,&quot;ac1d05cb-5f3d-48a9-8101-d4ccbd2dfd05&quot;,&quot;6ff02532-b393-4a0f-bad6-d5b989c92624&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;191303a6-c61c-47db-923d-d607cd2f2c18&quot;,&quot;title&quot;:&quot;UrlService Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;UrlService Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests \&quot;before each\&quot; hook in \&quot;UrlService Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;logger = createLogger()\n\n// Create mock database service\nmockDatabase = {\n  isConnected: true,\n  healthCheck: () =&gt; Promise.resolve({ healthy: true, responseTime: 10 }),\n  getClient: () =&gt; ({\n    url: {\n      create: (options) =&gt; Promise.resolve({\n        id: &#x27;test-id&#x27;,\n        originalUrl: options.data.originalUrl,\n        shortCode: options.data.shortCode,\n        createdAt: new Date(),\n        expiresAt: options.data.expiresAt,\n        clickCount: 0\n      }),\n      findUnique: () =&gt; Promise.resolve(null),\n      findMany: () =&gt; Promise.resolve([]),\n      update: () =&gt; Promise.resolve({ clickCount: 1 }),\n      delete: () =&gt; Promise.resolve({})\n    },\n    $transaction: (fn) =&gt; fn({\n      url: {\n        create: (options) =&gt; Promise.resolve({\n          id: &#x27;test-id&#x27;,\n          originalUrl: options.data.originalUrl,\n          shortCode: options.data.shortCode,\n          createdAt: new Date(),\n          expiresAt: options.data.expiresAt,\n          clickCount: 0\n        })\n      }\n    })\n  })\n}\n// Create mock Redis service\nmockRedis = {\n  isConnected: true,\n  getShortCode: () =&gt; Promise.resolve({\n    code: &#x27;abc123&#x27;,\n    source: &#x27;redis_pool&#x27;,\n    responseTime: 5\n  }),\n  cacheUrl: () =&gt; Promise.resolve(),\n  getCachedUrl: () =&gt; Promise.resolve(null),\n  removeCachedUrl: () =&gt; Promise.resolve()\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;505dcb23-7384-4ce6-ac6b-8669070460e9&quot;,&quot;parentUUID&quot;:&quot;191303a6-c61c-47db-923d-d607cd2f2c18&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;30c796eb-cd26-4cf0-a39c-9673d0ad1a25&quot;,&quot;title&quot;:&quot;Constructor and Dependency Validation&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should throw error when database service is missing&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Constructor and Dependency Validation should throw error when database service is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(() =&gt; {\n  new UrlService(null, mockRedis, logger)\n}).to.throw(&#x27;UrlService requires a database service instance&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f7981502-155f-4b3d-bfbe-1900c2cf5f4d&quot;,&quot;parentUUID&quot;:&quot;30c796eb-cd26-4cf0-a39c-9673d0ad1a25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw error when redis service is missing&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Constructor and Dependency Validation should throw error when redis service is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(() =&gt; {\n  new UrlService(mockDatabase, null, logger)\n}).to.throw(&#x27;UrlService requires a redis service instance&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51e713b7-6a1b-4fcc-bb03-ffbb9be1ba96&quot;,&quot;parentUUID&quot;:&quot;30c796eb-cd26-4cf0-a39c-9673d0ad1a25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw error when logger is missing&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Constructor and Dependency Validation should throw error when logger is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(() =&gt; {\n  new UrlService(mockDatabase, mockRedis, null)\n}).to.throw(&#x27;UrlService requires a logger instance&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a089bc54-6a18-4317-aa59-d7d7c3e97cb7&quot;,&quot;parentUUID&quot;:&quot;30c796eb-cd26-4cf0-a39c-9673d0ad1a25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize successfully with all dependencies&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Constructor and Dependency Validation should initialize successfully with all dependencies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(() =&gt; {\n  urlService = new UrlService(mockDatabase, mockRedis, logger)\n}).to.not.throw()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15475409-adab-43d4-aff6-723adb89dd5e&quot;,&quot;parentUUID&quot;:&quot;30c796eb-cd26-4cf0-a39c-9673d0ad1a25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f7981502-155f-4b3d-bfbe-1900c2cf5f4d&quot;,&quot;51e713b7-6a1b-4fcc-bb03-ffbb9be1ba96&quot;,&quot;a089bc54-6a18-4317-aa59-d7d7c3e97cb7&quot;,&quot;15475409-adab-43d4-aff6-723adb89dd5e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;title&quot;:&quot;Database Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Database Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests \&quot;before each\&quot; hook in \&quot;Database Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;urlService = new UrlService(mockDatabase, mockRedis, logger)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;405150ff-9581-4c11-b9ec-6fa96e4bdfb3&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should check database health before URL creation&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests should check database health before URL creation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let healthCheckCalled = false\nmockDatabase.healthCheck = () =&gt; {\n  healthCheckCalled = true\n  return Promise.resolve({ healthy: true, responseTime: 10 })\n}\nawait urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(healthCheckCalled).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;914f37ec-ef7f-43dd-96a5-749945d1074b&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database health check failure&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests should handle database health check failure&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.healthCheck = () =&gt; Promise.reject(new Error(&#x27;Database health check failed&#x27;))\ntry {\n  await urlService.createShortUrl(&#x27;https://example.com&#x27;)\n  expect.fail(&#x27;Should have thrown an error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Database service unavailable&#x27;)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;efaebb53-e73f-4555-b89e-39a702a335f3&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database disconnection&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests should handle database disconnection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.isConnected = false\nmockDatabase.healthCheck = () =&gt; Promise.reject(new Error(&#x27;Database client not connected&#x27;))\ntry {\n  await urlService.createShortUrl(&#x27;https://example.com&#x27;)\n  expect.fail(&#x27;Should have thrown an error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Database service unavailable&#x27;)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6633cbdb-b74d-4182-87a1-c488ea49a2c5&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database timeout errors&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests should handle database timeout errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.healthCheck = () =&gt; new Promise((_, reject) =&gt; {\n  setTimeout(() =&gt; reject(new Error(&#x27;Database health check timeout&#x27;)), 10)\n})\ntry {\n  await urlService.createShortUrl(&#x27;https://example.com&#x27;)\n  expect.fail(&#x27;Should have thrown an error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Database service unavailable&#x27;)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;def4ddca-1c46-4fc3-b602-add1612f77eb&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle unique constraint violations with retry&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests should handle unique constraint violations with retry&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let createCallCount = 0\nmockDatabase.getClient = () =&gt; ({\n  url: {\n    create: (options) =&gt; {\n      createCallCount++\n      if (createCallCount === 1) {\n        // First call fails with unique constraint violation\n        const error = new Error(&#x27;Unique constraint failed&#x27;)\n        error.code = &#x27;P2002&#x27;\n        error.meta = { target: [&#x27;shortCode&#x27;] }\n        return Promise.reject(error)\n      }\n      // Second call succeeds\n      return Promise.resolve({\n        id: &#x27;test-id&#x27;,\n        originalUrl: options.data.originalUrl,\n        shortCode: options.data.shortCode,\n        createdAt: new Date(),\n        expiresAt: options.data.expiresAt,\n        clickCount: 0\n      })\n    }\n  }\n})\nconst result = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(result).to.have.property(&#x27;shortCode&#x27;)\nexpect(createCallCount).to.equal(2)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0168a691-590a-4126-91f1-b02478a714fa&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database connection errors during operations&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Database Integration Tests should handle database connection errors during operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient = () =&gt; ({\n  url: {\n    create: (options) =&gt; {\n      const error = new Error(&#x27;Connection refused&#x27;)\n      error.code = &#x27;P1001&#x27;\n      return Promise.reject(error)\n    }\n  }\n})\ntry {\n  await urlService.createShortUrl(&#x27;https://example.com&#x27;)\n  expect.fail(&#x27;Should have thrown an error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Database service unavailable&#x27;)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1b69f203-a1fe-4caf-87ce-7e582d36e597&quot;,&quot;parentUUID&quot;:&quot;a9133285-1ec4-4632-b580-6dcdabae6255&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;914f37ec-ef7f-43dd-96a5-749945d1074b&quot;,&quot;efaebb53-e73f-4555-b89e-39a702a335f3&quot;,&quot;6633cbdb-b74d-4182-87a1-c488ea49a2c5&quot;,&quot;def4ddca-1c46-4fc3-b602-add1612f77eb&quot;,&quot;0168a691-590a-4126-91f1-b02478a714fa&quot;,&quot;1b69f203-a1fe-4caf-87ce-7e582d36e597&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;title&quot;:&quot;Redis Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Redis Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests \&quot;before each\&quot; hook in \&quot;Redis Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;urlService = new UrlService(mockDatabase, mockRedis, logger)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9476136-2093-43cd-973e-71e2068064b5&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get short code from Redis when available&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests should get short code from Redis when available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let redisGetShortCodeCalled = false\nmockRedis.getShortCode = () =&gt; {\n  redisGetShortCodeCalled = true\n  return Promise.resolve({\n    code: &#x27;redis123&#x27;,\n    source: &#x27;redis_pool&#x27;,\n    responseTime: 5\n  })\n}\nconst result = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(redisGetShortCodeCalled).to.be.true\nexpect(result.shortCode).to.be.a(&#x27;string&#x27;)\nexpect(result.shortCode).to.have.length.greaterThan(0)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f1f5cf3-156b-4eed-ad21-c039c6dee913&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fallback to local generation when Redis fails&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests should fallback to local generation when Redis fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.isConnected = false\nmockRedis.getShortCode = () =&gt; Promise.reject(new Error(&#x27;Redis connection failed&#x27;))\nconst result = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(result).to.have.property(&#x27;shortCode&#x27;)\nexpect(result.shortCode).to.be.a(&#x27;string&#x27;)\nexpect(result.shortCode).to.have.length.at.least(5) // Default fallback length&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;16853564-0829-4d11-ba05-0315caeedc05&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Redis disconnection gracefully&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests should handle Redis disconnection gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.isConnected = false\nconst result = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(result).to.have.property(&#x27;shortCode&#x27;)\n// Should use local fallback generation&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fa84e48c-5ead-4f30-a705-8357e53a670c&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should cache URLs when Redis is available&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests should cache URLs when Redis is available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let cacheUrlCalled = false\nmockRedis.cacheUrl = (shortCode, originalUrl, ttl) =&gt; {\n  cacheUrlCalled = true\n  expect(shortCode).to.be.a(&#x27;string&#x27;)\n  expect(originalUrl).to.equal(&#x27;https://example.com&#x27;)\n  expect(ttl).to.be.a(&#x27;number&#x27;)\n  return Promise.resolve()\n}\nawait urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(cacheUrlCalled).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f244162-2457-4ad5-9693-bbc33e055e92&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should continue operation even if caching fails&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests should continue operation even if caching fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.cacheUrl = () =&gt; Promise.reject(new Error(&#x27;Cache write failed&#x27;))\nconst result = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(result).to.have.property(&#x27;shortCode&#x27;)\n// Should complete successfully despite cache failure&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;378387dc-58b4-40ca-94c5-353917c1ea6a&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle cache retrieval failures gracefully&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Redis Integration Tests should handle cache retrieval failures gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Setup existing URL in database\nmockDatabase.getClient = () =&gt; ({\n  url: {\n    findUnique: () =&gt; Promise.resolve({\n      id: &#x27;test-id&#x27;,\n      originalUrl: &#x27;https://example.com&#x27;,\n      shortCode: &#x27;abc123&#x27;,\n      createdAt: new Date(),\n      expiresAt: new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000),\n      clickCount: 5\n    })\n  }\n})\nmockRedis.getCachedUrl = () =&gt; Promise.reject(new Error(&#x27;Cache read failed&#x27;))\nconst result = await urlService.getUrlByShortCode(&#x27;abc123&#x27;)\nexpect(result).to.have.property(&#x27;originalUrl&#x27;, &#x27;https://example.com&#x27;)\n// Should fallback to database lookup&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80c5341f-dd14-4223-bfaf-ca7e175f8eb2&quot;,&quot;parentUUID&quot;:&quot;a5626227-d0a1-4a0e-ad34-745beb551320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0f1f5cf3-156b-4eed-ad21-c039c6dee913&quot;,&quot;16853564-0829-4d11-ba05-0315caeedc05&quot;,&quot;fa84e48c-5ead-4f30-a705-8357e53a670c&quot;,&quot;7f244162-2457-4ad5-9693-bbc33e055e92&quot;,&quot;378387dc-58b4-40ca-94c5-353917c1ea6a&quot;,&quot;80c5341f-dd14-4223-bfaf-ca7e175f8eb2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1aa38be5-3a36-4cda-9200-89a9d085b2db&quot;,&quot;title&quot;:&quot;Graceful Degradation Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Graceful Degradation Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Graceful Degradation Tests \&quot;before each\&quot; hook in \&quot;Graceful Degradation Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;urlService = new UrlService(mockDatabase, mockRedis, logger)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3d04926a-c34b-49c8-a36b-6f33f20ec869&quot;,&quot;parentUUID&quot;:&quot;1aa38be5-3a36-4cda-9200-89a9d085b2db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should work with Redis completely unavailable&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Graceful Degradation Tests should work with Redis completely unavailable&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Simulate Redis completely down\nmockRedis.isConnected = false\nmockRedis.getShortCode = () =&gt; Promise.reject(new Error(&#x27;Redis unavailable&#x27;))\nmockRedis.cacheUrl = () =&gt; Promise.reject(new Error(&#x27;Redis unavailable&#x27;))\nmockRedis.getCachedUrl = () =&gt; Promise.reject(new Error(&#x27;Redis unavailable&#x27;))\nmockRedis.removeCachedUrl = () =&gt; Promise.reject(new Error(&#x27;Redis unavailable&#x27;))\n// Should still work with fallback mechanisms\nconst createResult = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(createResult).to.have.property(&#x27;shortCode&#x27;)\nexpect(createResult.shortCode).to.be.a(&#x27;string&#x27;)\n// Setup for retrieval test\nmockDatabase.getClient = () =&gt; ({\n  url: {\n    findUnique: (query) =&gt; Promise.resolve({\n      id: &#x27;test-id&#x27;,\n      originalUrl: &#x27;https://example.com&#x27;,\n      shortCode: query.where.shortCode,\n      createdAt: new Date(),\n      expiresAt: new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000),\n      clickCount: 0\n    }),\n    delete: () =&gt; Promise.resolve({})\n  }\n})\nconst getResult = await urlService.getUrlByShortCode(createResult.shortCode)\nexpect(getResult).to.have.property(&#x27;originalUrl&#x27;, &#x27;https://example.com&#x27;)\nconst deleteResult = await urlService.deleteUrl(createResult.shortCode)\nexpect(deleteResult).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ede5d692-c158-4e81-a6eb-e614231deedb&quot;,&quot;parentUUID&quot;:&quot;1aa38be5-3a36-4cda-9200-89a9d085b2db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle partial Redis functionality&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Graceful Degradation Tests should handle partial Redis functionality&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Redis connected but some operations fail\nmockRedis.isConnected = true\nmockRedis.getShortCode = () =&gt; Promise.resolve({\n  code: &#x27;partial123&#x27;,\n  source: &#x27;redis_pool&#x27;,\n  responseTime: 5\n})\nmockRedis.cacheUrl = () =&gt; Promise.reject(new Error(&#x27;Cache write failed&#x27;))\nmockRedis.getCachedUrl = () =&gt; Promise.reject(new Error(&#x27;Cache read failed&#x27;))\nconst result = await urlService.createShortUrl(&#x27;https://example.com&#x27;)\nexpect(result).to.have.property(&#x27;shortCode&#x27;)\nexpect(result.shortCode).to.be.a(&#x27;string&#x27;)\n// Should complete successfully despite cache failures&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4b804ab-ca89-494b-bb27-c9c789b5a521&quot;,&quot;parentUUID&quot;:&quot;1aa38be5-3a36-4cda-9200-89a9d085b2db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ede5d692-c158-4e81-a6eb-e614231deedb&quot;,&quot;e4b804ab-ca89-494b-bb27-c9c789b5a521&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ad9b9ad5-cede-4af0-824f-b9e7885171b9&quot;,&quot;title&quot;:&quot;Error Categorization Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Error Categorization Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Error Categorization Tests \&quot;before each\&quot; hook in \&quot;Error Categorization Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;urlService = new UrlService(mockDatabase, mockRedis, logger)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;851d8c67-a69d-42eb-bd38-b0363584e379&quot;,&quot;parentUUID&quot;:&quot;ad9b9ad5-cede-4af0-824f-b9e7885171b9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should categorize database connection errors correctly&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Error Categorization Tests should categorize database connection errors correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const connectionErrors = [\n  { code: &#x27;P1001&#x27;, message: &#x27;Can\\&#x27;t reach database server&#x27; },\n  { code: &#x27;P1002&#x27;, message: &#x27;Database server unreachable&#x27; },\n  { code: &#x27;P1008&#x27;, message: &#x27;Operations timed out&#x27; },\n  { message: &#x27;connection refused&#x27; },\n  { message: &#x27;connection timeout&#x27; }\n]\nfor (const errorData of connectionErrors) {\n  mockDatabase.getClient = () =&gt; ({\n    url: {\n      create: (options) =&gt; {\n        const error = new Error(errorData.message || &#x27;Connection error&#x27;)\n        if (errorData.code) error.code = errorData.code\n        return Promise.reject(error)\n      }\n    }\n  })\n  try {\n    await urlService.createShortUrl(&#x27;https://example.com&#x27;)\n    expect.fail(&#x27;Should have thrown an error&#x27;)\n  } catch (error) {\n    expect(error.message).to.include(&#x27;Database service unavailable&#x27;)\n  }\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82d3eaaf-f2a1-498b-af97-22fb6a28b12e&quot;,&quot;parentUUID&quot;:&quot;ad9b9ad5-cede-4af0-824f-b9e7885171b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle unique constraint violations appropriately&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Error Categorization Tests should handle unique constraint violations appropriately&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let attemptCount = 0\nlet getShortCodeCallCount = 0\n\n// Mock Redis to return different codes each time\nmockRedis.getShortCode = () =&gt; {\n  getShortCodeCallCount++\n  return Promise.resolve({\n    code: `attempt${getShortCodeCallCount}`,\n    source: &#x27;redis_pool&#x27;,\n    responseTime: 5\n  })\n}\n\nmockDatabase.getClient = () =&gt; ({\n  url: {\n    create: (options) =&gt; {\n      attemptCount++\n      // Always fail with unique constraint error - this will exhaust all 3 attempts\n      const error = new Error(&#x27;Unique constraint failed&#x27;)\n      error.code = &#x27;P2002&#x27;\n      error.meta = { target: [&#x27;shortCode&#x27;] }\n      return Promise.reject(error)\n    }\n  }\n})\n// Should fail after 3 attempts with the generic error message\ntry {\n  await urlService.createShortUrl(&#x27;https://example.com&#x27;)\n  expect.fail(&#x27;Should have thrown an error after max attempts&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to create shortened URL&#x27;)\n  expect(attemptCount).to.equal(3) // Should have tried 3 times\n  expect(getShortCodeCallCount).to.equal(3) // Initial + 2 retries\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;38608d0a-084d-47d0-8151-ac96d645054e&quot;,&quot;parentUUID&quot;:&quot;ad9b9ad5-cede-4af0-824f-b9e7885171b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;82d3eaaf-f2a1-498b-af97-22fb6a28b12e&quot;,&quot;38608d0a-084d-47d0-8151-ac96d645054e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;eeee368f-37d6-4450-9170-68edbe9e7023&quot;,&quot;title&quot;:&quot;Bulk Operations Integration&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/unit/UrlService-integration.test.js&quot;,&quot;file&quot;:&quot;/test/unit/UrlService-integration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Bulk Operations Integration\&quot;&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Bulk Operations Integration \&quot;before each\&quot; hook in \&quot;Bulk Operations Integration\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;urlService = new UrlService(mockDatabase, mockRedis, logger)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1dee6637-58ec-4a6c-afc8-4cb2e953c66d&quot;,&quot;parentUUID&quot;:&quot;eeee368f-37d6-4450-9170-68edbe9e7023&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle Redis unavailable during bulk operations&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Bulk Operations Integration should handle Redis unavailable during bulk operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockRedis.isConnected = false\n// Mock successful transaction\nlet transactionCalled = false\nmockDatabase.getClient = () =&gt; ({\n  $transaction: (fn) =&gt; {\n    transactionCalled = true\n    return fn({\n      url: {\n        create: (options) =&gt; Promise.resolve({\n          id: `test-id-${Date.now()}`,\n          originalUrl: options.data.originalUrl,\n          shortCode: options.data.shortCode,\n          createdAt: new Date(),\n          expiresAt: options.data.expiresAt,\n          clickCount: 0\n        })\n      }\n    })\n  }\n})\nconst result = await urlService.createBulkShortUrls([\n  &#x27;https://example1.com&#x27;,\n  &#x27;https://example2.com&#x27;\n])\nexpect(transactionCalled).to.be.true\nexpect(result.successCount).to.equal(2)\nexpect(result.failureCount).to.equal(0)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;97efe0a4-9727-47f4-830d-ed9985990526&quot;,&quot;parentUUID&quot;:&quot;eeee368f-37d6-4450-9170-68edbe9e7023&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle database failures during bulk operations&quot;,&quot;fullTitle&quot;:&quot;UrlService Integration Tests Bulk Operations Integration should handle database failures during bulk operations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockDatabase.getClient = () =&gt; ({\n  $transaction: () =&gt; Promise.reject(new Error(&#x27;Transaction failed&#x27;))\n})\ntry {\n  await urlService.createBulkShortUrls([\n    &#x27;https://example1.com&#x27;,\n    &#x27;https://example2.com&#x27;\n  ])\n  expect.fail(&#x27;Should have thrown an error&#x27;)\n} catch (error) {\n  expect(error.message).to.include(&#x27;Failed to create bulk URLs&#x27;)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d60d983f-1ba7-4b10-a648-6f48adcb930d&quot;,&quot;parentUUID&quot;:&quot;eeee368f-37d6-4450-9170-68edbe9e7023&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;97efe0a4-9727-47f4-830d-ed9985990526&quot;,&quot;d60d983f-1ba7-4b10-a648-6f48adcb930d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c9afa9be-3967-47e1-9b25-5cf9281c477f&quot;,&quot;title&quot;:&quot;URL Validators Unit Tests&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a2973da9-ecf0-4061-9b3c-e2ec6f6f6c3e&quot;,&quot;title&quot;:&quot;validateUrl()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;title&quot;:&quot;Valid URLs&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept valid URL: https://example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e660984-d014-4432-bfaa-8937ad2ed703&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: http://example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: http://example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;feb2178d-9ec8-4da9-a5b1-1a83cb95cb3b&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://www.example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://www.example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42114bd4-16ec-4538-bcd9-dd4546f6c7f5&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: http://www.example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: http://www.example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f63e6f48-19da-46f4-a991-c7a17d3229e1&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25a4830f-e711-4f77-a8d5-7fd60010c86e&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;537e8800-0391-4413-aafc-dd25097da1ec&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path/to/resource&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path/to/resource&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aba540d4-cdf8-4d06-abf3-9968595130fe&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path?query=value&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path?query=value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fdffed40-65f8-4d58-9c24-242e3af4d643&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path?query=value&amp;another=param&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path?query=value&amp;another=param&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6bbeb585-f6c1-4f12-8c3c-0651f8de14b8&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path#fragment&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path#fragment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6d49ab70-1d1a-4413-88ae-e2e5db090141&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path?query=value#fragment&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path?query=value#fragment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ffeaaf3c-3567-44f6-9b63-ac4e452b5000&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://subdomain.example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://subdomain.example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9311497-8e9d-4aa8-998d-44e8297d88ad&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://sub.domain.example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://sub.domain.example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98ba72ba-d96c-4fe0-9062-b82de3d3e2b8&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.co.uk&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.co.uk&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65cf1f05-1dcf-4bb5-8054-d350ff5be28c&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.org&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.org&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54880767-d784-46f2-aa0f-46265d773cbb&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.net&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.net&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b6add28d-5ec1-4b32-89f2-1eeae2967000&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com:8080&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com:8080&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4e40e62-38ec-4385-81a7-f7b8542a3779&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path/with-dashes&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path/with-dashes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e8019d68-6237-4fc3-9378-76d65b624a9c&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path/with_underscores&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path/with_underscores&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ac901fa-7dae-42bf-ac8c-a96b67f387ee&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path/with.dots&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path/with.dots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb9e0da4-8b87-43b0-8d0e-ed4bf5c81db0&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/path/with%20encoded%20spaces&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/path/with%20encoded%20spaces&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e2c7a692-7078-4d32-8ec7-489de95dbcbe&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://user@example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://user@example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;be14032f-cb44-436e-9ddb-132cfc77024b&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://user:pass@example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://user:pass@example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;41e28771-0b11-4fff-9863-f2c6591b6d03&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept valid URL: https://example.com/very/long/path/that/goes/on/and/on/for/a/while&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Valid URLs should accept valid URL: https://example.com/very/long/path/that/goes/on/and/on/for/a/while&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url, { allowLocalhost: true, allowIpAddresses: true })\nexpect(result.isValid).to.be.true\nexpect(result.error).to.be.undefined&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;91bac5a0-1fdf-4f87-8a64-1cd36b2c5c23&quot;,&quot;parentUUID&quot;:&quot;a65495f7-5ec1-4682-b942-a50fafabcd1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1e660984-d014-4432-bfaa-8937ad2ed703&quot;,&quot;feb2178d-9ec8-4da9-a5b1-1a83cb95cb3b&quot;,&quot;42114bd4-16ec-4538-bcd9-dd4546f6c7f5&quot;,&quot;f63e6f48-19da-46f4-a991-c7a17d3229e1&quot;,&quot;25a4830f-e711-4f77-a8d5-7fd60010c86e&quot;,&quot;537e8800-0391-4413-aafc-dd25097da1ec&quot;,&quot;aba540d4-cdf8-4d06-abf3-9968595130fe&quot;,&quot;fdffed40-65f8-4d58-9c24-242e3af4d643&quot;,&quot;6bbeb585-f6c1-4f12-8c3c-0651f8de14b8&quot;,&quot;6d49ab70-1d1a-4413-88ae-e2e5db090141&quot;,&quot;ffeaaf3c-3567-44f6-9b63-ac4e452b5000&quot;,&quot;b9311497-8e9d-4aa8-998d-44e8297d88ad&quot;,&quot;98ba72ba-d96c-4fe0-9062-b82de3d3e2b8&quot;,&quot;65cf1f05-1dcf-4bb5-8054-d350ff5be28c&quot;,&quot;54880767-d784-46f2-aa0f-46265d773cbb&quot;,&quot;b6add28d-5ec1-4b32-89f2-1eeae2967000&quot;,&quot;c4e40e62-38ec-4385-81a7-f7b8542a3779&quot;,&quot;e8019d68-6237-4fc3-9378-76d65b624a9c&quot;,&quot;6ac901fa-7dae-42bf-ac8c-a96b67f387ee&quot;,&quot;bb9e0da4-8b87-43b0-8d0e-ed4bf5c81db0&quot;,&quot;e2c7a692-7078-4d32-8ec7-489de95dbcbe&quot;,&quot;be14032f-cb44-436e-9ddb-132cfc77024b&quot;,&quot;41e28771-0b11-4fff-9863-f2c6591b6d03&quot;,&quot;91bac5a0-1fdf-4f87-8a64-1cd36b2c5c23&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;title&quot;:&quot;Invalid URLs&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should reject invalid URL: &quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cfada903-0d85-416c-b4b0-155fb99c1e5f&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL:    &quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL:    &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cd4a949-79b1-4ca1-bfac-7e71648d38bc&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: not-a-url&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: not-a-url&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b14e5c7-7552-4f8c-9f8f-a7bf1b6f4bf4&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: ftp://example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: ftp://example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9e0a91a6-8516-4193-b4da-0c6042316564&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: file:///local/file&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: file:///local/file&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;00cf6faf-f3d7-41e1-b34a-0865c5375b32&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: mailto:test@example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: mailto:test@example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff87c1b0-0fdf-46e0-ac4f-57b5e81a8e8c&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: javascript:alert(\&quot;xss\&quot;)&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: javascript:alert(\&quot;xss\&quot;)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ee32f73-a8b9-4b30-9148-7653c47d43b9&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: data:text/plain;base64,SGVsbG8=&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: data:text/plain;base64,SGVsbG8=&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;226c18a2-7156-4bd6-aa57-7d339008d3ae&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: http://&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: http://&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f5c02ae-90d8-4a6c-b55a-7b7019b457f6&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: https://&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: https://&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8544df6-8997-4e99-9d7c-a83f6467fad3&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: http:///&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: http:///&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17d3ba4e-d45a-4c82-9d1b-2121c7949185&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: https:///&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: https:///&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b29b8b14-c120-4b99-a019-86c97c6ffc8b&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid URL: //example.com&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Invalid URLs should reject invalid URL: //example.com&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateUrl(url)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.be.a(&#x27;string&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0eb931cf-8dae-49dd-9275-0f26cee792e7&quot;,&quot;parentUUID&quot;:&quot;1e6ebfa9-8d1f-430c-8cd5-2253a285acd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cfada903-0d85-416c-b4b0-155fb99c1e5f&quot;,&quot;7cd4a949-79b1-4ca1-bfac-7e71648d38bc&quot;,&quot;7b14e5c7-7552-4f8c-9f8f-a7bf1b6f4bf4&quot;,&quot;9e0a91a6-8516-4193-b4da-0c6042316564&quot;,&quot;00cf6faf-f3d7-41e1-b34a-0865c5375b32&quot;,&quot;ff87c1b0-0fdf-46e0-ac4f-57b5e81a8e8c&quot;,&quot;8ee32f73-a8b9-4b30-9148-7653c47d43b9&quot;,&quot;226c18a2-7156-4bd6-aa57-7d339008d3ae&quot;,&quot;0f5c02ae-90d8-4a6c-b55a-7b7019b457f6&quot;,&quot;b8544df6-8997-4e99-9d7c-a83f6467fad3&quot;,&quot;17d3ba4e-d45a-4c82-9d1b-2121c7949185&quot;,&quot;b29b8b14-c120-4b99-a019-86c97c6ffc8b&quot;,&quot;0eb931cf-8dae-49dd-9275-0f26cee792e7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1c92e7b8-99d3-41ec-9913-6a4f9a811961&quot;,&quot;title&quot;:&quot;URL Length Validation&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should reject URLs exceeding default length limit (2048 characters)&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() URL Length Validation should reject URLs exceeding default length limit (2048 characters)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const longUrl = &#x27;https://example.com/&#x27; + &#x27;a&#x27;.repeat(2100)\nconst result = validateUrl(longUrl)\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;exceeds maximum length&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b0177f4f-e769-488c-962d-8f1638f3eb3a&quot;,&quot;parentUUID&quot;:&quot;1c92e7b8-99d3-41ec-9913-6a4f9a811961&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject URLs exceeding custom length limit&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() URL Length Validation should reject URLs exceeding custom length limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mediumUrl = &#x27;https://example.com/&#x27; + &#x27;a&#x27;.repeat(500)\nconst result = validateUrl(mediumUrl, { maxLength: 100 })\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;exceeds maximum length&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d2fabc9-7829-490b-a1e0-fd1d92068cd5&quot;,&quot;parentUUID&quot;:&quot;1c92e7b8-99d3-41ec-9913-6a4f9a811961&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should accept URLs within length limits&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() URL Length Validation should accept URLs within length limits&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validUrl = &#x27;https://example.com/short&#x27;\nconst result = validateUrl(validUrl, { maxLength: 100 })\n\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ce663072-07bb-4735-97e9-ff058cdc6e61&quot;,&quot;parentUUID&quot;:&quot;1c92e7b8-99d3-41ec-9913-6a4f9a811961&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b0177f4f-e769-488c-962d-8f1638f3eb3a&quot;,&quot;0d2fabc9-7829-490b-a1e0-fd1d92068cd5&quot;,&quot;ce663072-07bb-4735-97e9-ff058cdc6e61&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b82ad087-136d-4bd4-95cc-ab384f292306&quot;,&quot;title&quot;:&quot;Edge Cases&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle null and undefined input&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Edge Cases should handle null and undefined input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(validateUrl(null).isValid).to.be.false\nexpect(validateUrl(undefined).isValid).to.be.false\nexpect(validateUrl().isValid).to.be.false&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61f80004-6444-4623-bb2c-89154b4115d8&quot;,&quot;parentUUID&quot;:&quot;b82ad087-136d-4bd4-95cc-ab384f292306&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-string input&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Edge Cases should handle non-string input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(validateUrl(123).isValid).to.be.false\nexpect(validateUrl({}).isValid).to.be.false\nexpect(validateUrl([]).isValid).to.be.false&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7eb17a24-c8e7-4932-9b28-e0e76332de94&quot;,&quot;parentUUID&quot;:&quot;b82ad087-136d-4bd4-95cc-ab384f292306&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle very short URLs&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Edge Cases should handle very short URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const shortUrl = &#x27;http://a.b&#x27;\nconst result = validateUrl(shortUrl)\n\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dd7103fc-2d61-42c2-9c8e-6a1fcec8ff2e&quot;,&quot;parentUUID&quot;:&quot;b82ad087-136d-4bd4-95cc-ab384f292306&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;61f80004-6444-4623-bb2c-89154b4115d8&quot;,&quot;7eb17a24-c8e7-4932-9b28-e0e76332de94&quot;,&quot;dd7103fc-2d61-42c2-9c8e-6a1fcec8ff2e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3b94952c-2faf-42ba-aff8-0902a6ea6094&quot;,&quot;title&quot;:&quot;Configuration Options&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should respect allowLocalhost option when false&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Configuration Options should respect allowLocalhost option when false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const localhostUrl = &#x27;http://localhost:3000&#x27;\nconst result = validateUrl(localhostUrl, { allowLocalhost: false })\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;localhost&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;05a7221f-7b15-4ab8-a326-ec05efb224ac&quot;,&quot;parentUUID&quot;:&quot;3b94952c-2faf-42ba-aff8-0902a6ea6094&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect allowIpAddresses option when false&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Configuration Options should respect allowIpAddresses option when false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const ipUrl = &#x27;http://192.168.1.1&#x27;\nconst result = validateUrl(ipUrl, { allowIpAddresses: false })\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;IP address&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;368ac203-2ef2-4b4f-a5a7-7b53b9855e74&quot;,&quot;parentUUID&quot;:&quot;3b94952c-2faf-42ba-aff8-0902a6ea6094&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow localhost when allowLocalhost is true&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Configuration Options should allow localhost when allowLocalhost is true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const localhostUrl = &#x27;http://localhost:3000&#x27;\nconst result = validateUrl(localhostUrl, { allowLocalhost: true })\n\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80482a48-4b2b-438a-9614-9baa48a1e451&quot;,&quot;parentUUID&quot;:&quot;3b94952c-2faf-42ba-aff8-0902a6ea6094&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow IP addresses when allowIpAddresses is true&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateUrl() Configuration Options should allow IP addresses when allowIpAddresses is true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const ipUrl = &#x27;http://192.168.1.1&#x27;\nconst result = validateUrl(ipUrl, { allowIpAddresses: true })\n\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a857befc-ae19-418d-a4d0-45ab3cc592f1&quot;,&quot;parentUUID&quot;:&quot;3b94952c-2faf-42ba-aff8-0902a6ea6094&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;05a7221f-7b15-4ab8-a326-ec05efb224ac&quot;,&quot;368ac203-2ef2-4b4f-a5a7-7b53b9855e74&quot;,&quot;80482a48-4b2b-438a-9614-9baa48a1e451&quot;,&quot;a857befc-ae19-418d-a4d0-45ab3cc592f1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;title&quot;:&quot;validateBulkUrls()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should validate array of valid URLs&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should validate array of valid URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com&#x27;,\n  &#x27;https://google.com&#x27;,\n  &#x27;https://github.com&#x27;\n]\nconst result = validateBulkUrls(urls)\n\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;43dde771-ec99-407b-a668-182f2d95f260&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject empty array&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should reject empty array&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateBulkUrls([])\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;cannot be empty&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;69bda29a-6d3e-4f55-b4f5-306440418eec&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject non-array input&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should reject non-array input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = &#x27;not-an-array&#x27;\nconst result = validateBulkUrls(urls)\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;must be provided as an array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17934281-9059-4064-a292-4704e70d0437&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate mixed valid and invalid URLs&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should validate mixed valid and invalid URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com&#x27;,\n  &#x27;invalid-url&#x27;,\n  &#x27;https://github.com&#x27;,\n  &#x27;&#x27;\n]\nconst result = validateBulkUrls(urls)\n\nexpect(result.isValid).to.be.false\nexpect(result.failedUrls).to.have.length(2)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51e658ec-4d96-4ca0-9b61-4161b51df21b&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject array exceeding maximum count&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should reject array exceeding maximum count&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = new Array(1001).fill(&#x27;https://example.com&#x27;)\nconst result = validateBulkUrls(urls, { maxCount: 1000 })\n\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;limited to 1000 URLs&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40bd48dd-ea3a-4945-857f-d2f96848cee7&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate array with custom options&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should validate array with custom options&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com&#x27;,\n  &#x27;https://google.com&#x27;\n]\nconst result = validateBulkUrls(urls)\n\nexpect(result.isValid).to.be.true\nexpect(result.validCount).to.equal(2)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8fddc535-e06d-428d-a709-e9094dea5e15&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle edge cases gracefully&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should handle edge cases gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(() =&gt; validateBulkUrls(&#x27;not-an-array&#x27;)).to.not.throw()\nexpect(() =&gt; validateBulkUrls(null)).to.not.throw()\nexpect(() =&gt; validateBulkUrls(undefined)).to.not.throw()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;129c71ca-7817-4486-879f-566437962a64&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should provide detailed error information for invalid URLs&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should provide detailed error information for invalid URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com&#x27;,\n  &#x27;invalid-url&#x27;,\n  &#x27;ftp://unsupported.com&#x27;\n]\nconst result = validateBulkUrls(urls)\n\nexpect(result.isValid).to.be.false\nexpect(result.failedUrls).to.have.length(2)\nexpect(result.details).to.be.an(&#x27;array&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1c4e848-5423-4579-8118-17a9e331f77b&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle URLs with special characters and encoding&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should handle URLs with special characters and encoding&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com/path?query=value&amp;another=test&#x27;,\n  &#x27;https://example.com/Ã¼nicode&#x27;\n]\nconst result = validateBulkUrls(urls)\n\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5dab0583-da0d-4579-9274-963e995e8223&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle performance testing with large arrays&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should handle performance testing with large arrays&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = new Array(100).fill(&#x27;https://example.com&#x27;)\n\nconst startTime = Date.now()\nconst result = validateBulkUrls(urls)\nconst endTime = Date.now()\nexpect(result.isValid).to.be.true\nexpect(endTime - startTime).to.be.lessThan(1000) // Should complete within 1 second&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;900f2e42-a6c8-4844-b96b-797d90c9f7f5&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should provide detailed error information for mixed URLs&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateBulkUrls() should provide detailed error information for mixed URLs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const urls = [\n  &#x27;https://example.com&#x27;,\n  &#x27;invalid-url-1&#x27;,\n  &#x27;http://valid.com&#x27;,\n  &#x27;invalid-url-2&#x27;\n]\nconst result = validateBulkUrls(urls)\nexpect(result.isValid).to.be.false\nexpect(result.failedUrls).to.have.length(2)\nexpect(result.validCount).to.equal(2)\nexpect(result.totalCount).to.equal(4)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;505399b3-72b1-4360-b01a-124344cb69fd&quot;,&quot;parentUUID&quot;:&quot;f7dfdc80-e948-4085-8fe6-69dc9a419c5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;43dde771-ec99-407b-a668-182f2d95f260&quot;,&quot;69bda29a-6d3e-4f55-b4f5-306440418eec&quot;,&quot;17934281-9059-4064-a292-4704e70d0437&quot;,&quot;51e658ec-4d96-4ca0-9b61-4161b51df21b&quot;,&quot;40bd48dd-ea3a-4945-857f-d2f96848cee7&quot;,&quot;8fddc535-e06d-428d-a709-e9094dea5e15&quot;,&quot;129c71ca-7817-4486-879f-566437962a64&quot;,&quot;e1c4e848-5423-4579-8118-17a9e331f77b&quot;,&quot;5dab0583-da0d-4579-9274-963e995e8223&quot;,&quot;900f2e42-a6c8-4844-b96b-797d90c9f7f5&quot;,&quot;505399b3-72b1-4360-b01a-124344cb69fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8768f257-002f-4536-b4c6-85fab726ce53&quot;,&quot;title&quot;:&quot;validateShortCode()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept valid short codes&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateShortCode() should accept valid short codes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validCodes = [&#x27;abc12&#x27;, &#x27;XYZ99&#x27;, &#x27;aBc12&#x27;]\n\nvalidCodes.forEach(code =&gt; {\n  const result = validateShortCode(code)\n  expect(result.isValid).to.be.true\n  expect(result.error).to.be.undefined\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;02eb7867-2739-4798-b534-51eb14db9d12&quot;,&quot;parentUUID&quot;:&quot;8768f257-002f-4536-b4c6-85fab726ce53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject invalid short codes&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateShortCode() should reject invalid short codes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidCodes = [\n  &#x27;&#x27;,           // empty\n  &#x27;a&#x27;,          // too short \n  &#x27;abcdef&#x27;,     // too long (default is 5 chars)\n  &#x27;abc!@&#x27;,      // invalid characters\n  &#x27;12345&#x27;       // numbers only (depends on charset config)\n]\n\ninvalidCodes.forEach(code =&gt; {\n  const result = validateShortCode(code)\n  expect(result.isValid).to.be.false\n  expect(result.error).to.be.a(&#x27;string&#x27;)\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected true to be false&quot;,&quot;estack&quot;:&quot;AssertionError: expected true to be false\n    at file:///Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js:300:37\n    at Array.forEach (&lt;anonymous&gt;)\n    at Context.&lt;anonymous&gt; (file:///Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js:298:20)\n    at process.processImmediate (node:internal/timers:476:21)&quot;,&quot;diff&quot;:&quot;- true\n+ false\n&quot;},&quot;uuid&quot;:&quot;7e1a7a7a-caab-4f2b-8637-68d5a22abfdb&quot;,&quot;parentUUID&quot;:&quot;8768f257-002f-4536-b4c6-85fab726ce53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle null and undefined input&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateShortCode() should handle null and undefined input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(validateShortCode(null).isValid).to.be.false\nexpect(validateShortCode(undefined).isValid).to.be.false\nexpect(validateShortCode().isValid).to.be.false&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;691e83ba-3d73-4ab4-aa2b-c41559a190db&quot;,&quot;parentUUID&quot;:&quot;8768f257-002f-4536-b4c6-85fab726ce53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-string input&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateShortCode() should handle non-string input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(validateShortCode(123).isValid).to.be.false\nexpect(validateShortCode({}).isValid).to.be.false\nexpect(validateShortCode([]).isValid).to.be.false&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;255f610b-ad87-453a-bd96-642831ad1c21&quot;,&quot;parentUUID&quot;:&quot;8768f257-002f-4536-b4c6-85fab726ce53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate short code length&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateShortCode() should validate short code length&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const exactLength = &#x27;abc12&#x27; // 5 characters (default expected length)\nconst result = validateShortCode(exactLength)\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;959584ec-d258-4e6e-aa2d-b34793c364d3&quot;,&quot;parentUUID&quot;:&quot;8768f257-002f-4536-b4c6-85fab726ce53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;02eb7867-2739-4798-b534-51eb14db9d12&quot;,&quot;691e83ba-3d73-4ab4-aa2b-c41559a190db&quot;,&quot;255f610b-ad87-453a-bd96-642831ad1c21&quot;,&quot;959584ec-d258-4e6e-aa2d-b34793c364d3&quot;],&quot;failures&quot;:[&quot;7e1a7a7a-caab-4f2b-8637-68d5a22abfdb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;262d6276-1432-474b-aa02-9eb0b57fd43f&quot;,&quot;title&quot;:&quot;validateRequestSize()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should validate request body size limits&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateRequestSize() should validate request body size limits&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestBody = {\n  urls: new Array(50).fill(&#x27;https://example.com&#x27;)\n}\n\nconst result = validateRequestSize(requestBody)\nexpect(result.isValid).to.be.true&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a22f61c0-9517-4688-a89e-09cc0b89ae2b&quot;,&quot;parentUUID&quot;:&quot;262d6276-1432-474b-aa02-9eb0b57fd43f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject request body exceeding URL count limit&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateRequestSize() should reject request body exceeding URL count limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestBody = {\n  urls: new Array(1001).fill(&#x27;https://example.com&#x27;)\n}\n\nconst result = validateRequestSize(requestBody, { maxUrlCount: 1000 })\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;limited to 1000 URLs&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3808c59-83b5-4f97-b1c0-04e6648240e8&quot;,&quot;parentUUID&quot;:&quot;262d6276-1432-474b-aa02-9eb0b57fd43f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-object request body&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests validateRequestSize() should handle non-object request body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = validateRequestSize(&#x27;not-an-object&#x27;)\nexpect(result.isValid).to.be.false\nexpect(result.error).to.include(&#x27;must be a valid object&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25ee96f1-4b1c-4a92-8345-a72d67e25ded&quot;,&quot;parentUUID&quot;:&quot;262d6276-1432-474b-aa02-9eb0b57fd43f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a22f61c0-9517-4688-a89e-09cc0b89ae2b&quot;,&quot;e3808c59-83b5-4f97-b1c0-04e6648240e8&quot;,&quot;25ee96f1-4b1c-4a92-8345-a72d67e25ded&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5f0ad426-2e58-46c7-bc98-238b20cc7117&quot;,&quot;title&quot;:&quot;createValidationErrorResponse()&quot;,&quot;fullFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/test/utils/validators.test.js&quot;,&quot;file&quot;:&quot;/test/utils/validators.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return null for valid results&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests createValidationErrorResponse() should return null for valid results&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validResult = { isValid: true }\nconst result = createValidationErrorResponse(validResult)\nexpect(result).to.be.null&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b3dc376b-6bdd-4db6-90f2-dfca79dda0cb&quot;,&quot;parentUUID&quot;:&quot;5f0ad426-2e58-46c7-bc98-238b20cc7117&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should format error response for invalid results&quot;,&quot;fullTitle&quot;:&quot;URL Validators Unit Tests createValidationErrorResponse() should format error response for invalid results&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidResult = {\n  isValid: false,\n  error: &#x27;Test error&#x27;,\n  details: [&#x27;Detail 1&#x27;, &#x27;Detail 2&#x27;]\n}\n\nconst result = createValidationErrorResponse(invalidResult, &#x27;test context&#x27;)\nexpect(result.error).to.equal(&#x27;Test error&#x27;)\nexpect(result.details).to.be.an(&#x27;array&#x27;)\nexpect(result.context).to.equal(&#x27;test context&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4b63dc6-df5d-4c33-a64a-0fb236b37dce&quot;,&quot;parentUUID&quot;:&quot;5f0ad426-2e58-46c7-bc98-238b20cc7117&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b3dc376b-6bdd-4db6-90f2-dfca79dda0cb&quot;,&quot;f4b63dc6-df5d-4c33-a64a-0fb236b37dce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;url-shortner-ai-demo&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/Users/andrew/Dev/url-shortner-ai-demo/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>